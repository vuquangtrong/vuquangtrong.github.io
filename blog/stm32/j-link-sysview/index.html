
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="SEGGER SystemView is a real-time recording and visualization tool for embedded systems that reveals the true runtime behavior of an application, going far deeper than the system insights provided by debuggers. This is particularly effective when developing and working with complex embedded systems comprising multiple threads and interrupts. SystemView can ensure a system performs as designed, can track down inefficiencies, and find unintended interactions and resource conflicts." name="description"/>
<meta content="embedded systems application programming" name="keywords"/>
<meta content="vqtrong" name="author"/>
<link href="https://www.codeinsideout.com/blog/stm32/j-link-sysview/" rel="canonical"/>
<link href="../../../favicon.png" rel="icon"/>
<meta content="mkdocs-1.2.1, mkdocs-material-7.1.9" name="generator"/>
<title>J-Link System View - Code Inside Out</title>
<link href="../../../assets/stylesheets/main.ca7ac06f.min.css" rel="stylesheet"/>
<link href="../../../assets/stylesheets/palette.f1a3b89f.min.css" rel="stylesheet"/>
<meta content="#ffffff" name="theme-color"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Noto+Serif:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Noto Serif";--md-code-font-family:"Roboto Mono"}</style>
<link href="../../../assets/view-bigimg.css" rel="stylesheet"/>
<link href="../../../assets/extra.css" rel="stylesheet"/>
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-42618265-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<meta content="website" property="og:type">
<meta content="J-Link System View - Code Inside Out" property="og:title">
<meta content="SEGGER SystemView is a real-time recording and visualization tool for embedded systems that reveals the true runtime behavior of an application, going far deeper than the system insights provided by debuggers. This is particularly effective when developing and working with complex embedded systems comprising multiple threads and interrupts. SystemView can ensure a system performs as designed, can track down inefficiencies, and find unintended interactions and resource conflicts." property="og:description">
<meta content="https://www.codeinsideout.com/blog/stm32/j-link-sysview/" property="og:url">
<meta content="https://www.codeinsideout.com/assets/banner.jpg" property="og:image">
<meta content="Code Inside Out" property="og:site_name">
<meta content="summary" name="twitter:card">
</meta></meta></meta></meta></meta></meta></meta></head>
<body data-md-color-accent="deep-orange" data-md-color-primary="white" data-md-color-scheme="" dir="ltr">
<script>function __prefix(e){return new URL("../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#1-system-view">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Code Inside Out" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="Code Inside Out">
<svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Code Inside Out
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              J-Link SysView
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" data-md-state="active" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../..">
      Home
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="../../">
      Blog
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../projects/">
      Projects
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../archives/">
      Archives
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../tags/">
      Tags
    </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<style>
        .tag-cloud-toc {
            display: none;
        }
        @media screen and (max-width: 76.1875em) {
            .tag-cloud-toc {
                display: block;
            }
        }
    </style>
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Code Inside Out" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="Code Inside Out">
<svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"></path></svg>
</a>
    Code Inside Out
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../..">
        Home
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../" style="margin: initial; padding: initial; pointer-events: initial">
        
          Blog
        </a>
</label>
<nav aria-label="Blog" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../" style="margin: initial; padding: initial; pointer-events: initial">
          
            Blog
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" id="__nav_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../" style="margin: initial; padding: initial; pointer-events: initial">
        
          STM32
        </a>
</label>
<nav aria-label="STM32" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_1">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../" style="margin: initial; padding: initial; pointer-events: initial">
          
            STM32
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../intro/">
        Introduction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../prepare/">
        Preparation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tools/">
        Toolchain
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../docs/">
        Documents
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../clock/">
        Clock Tree
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../interrupt/">
        Interrupt
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../semihosting/">
        Semihosting
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../gpio/">
        GPIO
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../dma/">
        DMA
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../swv/">
        SWV
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../add-swo/">
        Add SWO
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../uart/">
        UART
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../uart-redirection/">
        UART Redirection
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../timer/">
        Timers
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../sensor-us-100/">
        US-100 Sensor
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../adc/">
        ADC
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../i2c-spi/">
        I2C - SPI
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../oled-ssd1306/">
        SSD1306 OLED
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../j-link-rtt/">
        J-Link RTT
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link md-nav__link--active" href="./" style="margin: initial; padding: initial; pointer-events: initial">
          
            J-Link SysView
          </a>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        J-Link SysView
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-system-view">
    1. System View
  </a>
<nav aria-label="1. System View" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11-how-system-view-works">
    1.1. How System View Works
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12-figure-out-potential-problems">
    1.2. Figure out Potential problems
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#13-system-view-license">
    1.3. System View License
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#14-system-view-apis">
    1.4. System View APIs
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-system-view-integration">
    2. System View Integration
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-lab-analyze-a-non-os-firmware">
    3. Lab: Analyze a Non-OS firmware
  </a>
<nav aria-label="3. Lab: Analyze a Non-OS firmware" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#31-start-a-new-project">
    3.1. Start a new project
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#32-import-system-view-files">
    3.2. Import System View files
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#33-configure-system-view">
    3.3. Configure System View
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#34-print-messages-to-host">
    3.4. Print messages to host
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#35-run-the-system-view">
    3.5. Run the System View
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#36-record-interrupts">
    3.6. Record interrupts
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#37-record-a-function">
    3.7. Record a function
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#38-os-description-file">
    3.8. OS Description file
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#39-measure-performance">
    3.9. Measure performance
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-appendix">
    4. Appendix
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../notes/">
        Notes
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" id="__nav_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../pi/" style="margin: initial; padding: initial; pointer-events: initial">
        
          Raspberry Pi
        </a>
</label>
<nav aria-label="Raspberry Pi" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../pi/" style="margin: initial; padding: initial; pointer-events: initial">
          
            Raspberry Pi
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/headless-mode/">
        Headless mode
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/compile-ffmpeg/">
        Compile FFmpeg
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/resource-usage/">
        Resource usage
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/setup-camera/">
        Setup Camera
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/stream-ffmpeg-hls-dash/">
        HLS/DASH Streaming
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/stream-picamera-mjpeg/">
        MJPEG streaming
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/stream-picamera-h264/">
        H264 streaming
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/backup-sdcard/">
        Backup SDCard
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/check-camera-i2c/">
        Diagnostic Camera
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../pi/notes/">
        Notes
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" id="__nav_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../c-cpp/" style="margin: initial; padding: initial; pointer-events: initial">
        
          C/C++
        </a>
</label>
<nav aria-label="C/C++" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../c-cpp/" style="margin: initial; padding: initial; pointer-events: initial">
          
            C/C++
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../c-cpp/notes/">
        Notes
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" id="__nav_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../lidar/" style="margin: initial; padding: initial; pointer-events: initial">
        
          Lidar
        </a>
</label>
<nav aria-label="Lidar" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../lidar/" style="margin: initial; padding: initial; pointer-events: initial">
          
            Lidar
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../lidar/livox-sdk/">
        Livox SDK
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../lidar/mapping/">
        Lidar Mapping
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" id="__nav_2_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../setup-blog/" style="margin: initial; padding: initial; pointer-events: initial">
        
          Setup blog
        </a>
</label>
<nav aria-label="Setup blog" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../setup-blog/" style="margin: initial; padding: initial; pointer-events: initial">
          
            Setup blog
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../setup-blog/markdown-syntax/">
        Markdown syntax
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../setup-blog/mkdocs-plugins/">
        MkDocs plugins
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../setup-blog/customize-theme/">
        Customize theme
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../setup-blog/print-to-pdf/">
        Print to PDF
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../setup-blog/fix-ajax-issue/">
        Fix AJAX issue
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" id="__nav_2_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_6">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../virtual-machine/" style="margin: initial; padding: initial; pointer-events: initial">
        
          Virtual machine
        </a>
</label>
<nav aria-label="Virtual machine" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_6">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../virtual-machine/" style="margin: initial; padding: initial; pointer-events: initial">
          
            Virtual machine
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../virtual-machine/docker/">
        Docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../virtual-machine/hyper-v/">
        Hyper-V
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../projects/">
        Projects
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../archives/">
        Archives
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../tags/">
        Tags
      </a>
</li>
</ul>
</nav>
<div class="tag-cloud-nav">
<p class="md-nav" style="margin-bottom: 0.5em;">
<label class="md-nav__title">Tag cloud</label>
</p>
<div class="tag-cloud-content">
<a class="tag" href="https://www.codeinsideout.com/tags/#sensor">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">sensor</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#sysview">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateGray;
        ">sysview</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#gnuplot">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkViolet;
        ">gnuplot</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#awk">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkTurquoise;
        ">awk</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#arm">
<span class="tag-name" style="
          font-size:1.3rem;
          color:DarkMagenta;
        ">arm</span>
<!--<sup class="tag-count">16</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#restore">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkMagenta;
        ">restore</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#interrupt">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkGreen;
        ">interrupt</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#omx">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkViolet;
        ">omx</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#debug">
<span class="tag-name" style="
          font-size:0.75rem;
          color:DarkSlateBlue;
        ">debug</span>
<!--<sup class="tag-count">5</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#mjpeg">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkViolet;
        ">mjpeg</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#markdown">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">markdown</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#toolchain">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkTurquoise;
        ">toolchain</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#timer">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">timer</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#hardware accelerator">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateBlue;
        ">hardware accelerator</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#ffmpeg">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkGreen;
        ">ffmpeg</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#jinja">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateBlue;
        ">jinja</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#oled">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGreen;
        ">oled</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#stream">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkViolet;
        ">stream</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#c++">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateBlue;
        ">c++</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pwm">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">pwm</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#adc">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">adc</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#camera">
<span class="tag-name" style="
          font-size:0.75rem;
          color:DarkBlue;
        ">camera</span>
<!--<sup class="tag-count">5</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#material">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">material</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#semihosting">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">semihosting</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#container">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGreen;
        ">container</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#headless">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkMagenta;
        ">headless</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#sdcard">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">sdcard</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#swv">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkTurquoise;
        ">swv</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pulse">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">pulse</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#docs">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">docs</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#mkdocs">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkTurquoise;
        ">mkdocs</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#ssd1306">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">ssd1306</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#ajax">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">ajax</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#rtt">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkRed;
        ">rtt</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#gpio">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">gpio</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#html">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOrchid;
        ">html</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#picamera">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkOrchid;
        ">picamera</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#board">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOrchid;
        ">board</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#docker">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateGray;
        ">docker</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#i2c">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkGreen;
        ">i2c</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#h264">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOrchid;
        ">h264</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#hls">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateBlue;
        ">hls</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#clock">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">clock</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#distance">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">distance</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#livox">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkViolet;
        ">livox</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#lidar">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkOliveGreen;
        ">lidar</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#spi">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkCyan;
        ">spi</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#javascript">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkCyan;
        ">javascript</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#capture">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">capture</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#mapping">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">mapping</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pdf">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">pdf</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#python">
<span class="tag-name" style="
          font-size:0.75rem;
          color:DarkGoldenrod;
        ">python</span>
<!--<sup class="tag-count">5</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#c">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">c</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#performance">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkViolet;
        ">performance</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#css">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkCyan;
        ">css</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#v4l2">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkMagenta;
        ">v4l2</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#top">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOrchid;
        ">top</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#redirect">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">redirect</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#usart">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateGray;
        ">usart</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#stm32">
<span class="tag-name" style="
          font-size:1.4rem;
          color:DarkGoldenrod;
        ">stm32</span>
<!--<sup class="tag-count">18</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#notes">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkOrchid;
        ">notes</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#dma">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkCyan;
        ">dma</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#bash">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkTurquoise;
        ">bash</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#uart">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkSlateBlue;
        ">uart</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#dash">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkCyan;
        ">dash</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#grep">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkMagenta;
        ">grep</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#virtual">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkMagenta;
        ">virtual</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#backup">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGreen;
        ">backup</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#joystick">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkTurquoise;
        ">joystick</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pi">
<span class="tag-name" style="
          font-size:0.95rem;
          color:DarkMagenta;
        ">pi</span>
<!--<sup class="tag-count">9</sup>-->
</a>
</div>
</div>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-system-view">
    1. System View
  </a>
<nav aria-label="1. System View" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11-how-system-view-works">
    1.1. How System View Works
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12-figure-out-potential-problems">
    1.2. Figure out Potential problems
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#13-system-view-license">
    1.3. System View License
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#14-system-view-apis">
    1.4. System View APIs
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-system-view-integration">
    2. System View Integration
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-lab-analyze-a-non-os-firmware">
    3. Lab: Analyze a Non-OS firmware
  </a>
<nav aria-label="3. Lab: Analyze a Non-OS firmware" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#31-start-a-new-project">
    3.1. Start a new project
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#32-import-system-view-files">
    3.2. Import System View files
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#33-configure-system-view">
    3.3. Configure System View
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#34-print-messages-to-host">
    3.4. Print messages to host
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#35-run-the-system-view">
    3.5. Run the System View
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#36-record-interrupts">
    3.6. Record interrupts
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#37-record-a-function">
    3.7. Record a function
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#38-os-description-file">
    3.8. OS Description file
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#39-measure-performance">
    3.9. Measure performance
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-appendix">
    4. Appendix
  </a>
</li>
</ul>
</nav>
<div class="tag-cloud-toc">
<p class="md-nav" style="margin-bottom: 0.5em;">
<label class="md-nav__title">Tag cloud</label>
</p>
<div class="tag-cloud-content">
<a class="tag" href="https://www.codeinsideout.com/tags/#clock">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGreen;
        ">clock</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#stream">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkGoldenrod;
        ">stream</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#hls">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkCyan;
        ">hls</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#headless">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">headless</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#sysview">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkTurquoise;
        ">sysview</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#lidar">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkRed;
        ">lidar</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#gnuplot">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGoldenrod;
        ">gnuplot</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#gpio">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOrchid;
        ">gpio</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#javascript">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkCyan;
        ">javascript</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#ajax">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkCyan;
        ">ajax</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#dash">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateGray;
        ">dash</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#mkdocs">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkMagenta;
        ">mkdocs</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#css">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkMagenta;
        ">css</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#restore">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">restore</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#omx">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateGray;
        ">omx</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#uart">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkViolet;
        ">uart</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#mapping">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGoldenrod;
        ">mapping</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#i2c">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkGreen;
        ">i2c</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#backup">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkCyan;
        ">backup</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#virtual">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">virtual</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#material">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">material</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#notes">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkOrchid;
        ">notes</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#interrupt">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkOliveGreen;
        ">interrupt</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#awk">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">awk</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#rtt">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkSlateBlue;
        ">rtt</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#spi">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkCyan;
        ">spi</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pi">
<span class="tag-name" style="
          font-size:0.95rem;
          color:DarkSlateBlue;
        ">pi</span>
<!--<sup class="tag-count">9</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#stm32">
<span class="tag-name" style="
          font-size:1.4rem;
          color:DarkSlateBlue;
        ">stm32</span>
<!--<sup class="tag-count">18</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#semihosting">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGoldenrod;
        ">semihosting</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pwm">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkViolet;
        ">pwm</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#html">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateBlue;
        ">html</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#hardware accelerator">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkCyan;
        ">hardware accelerator</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#picamera">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkGreen;
        ">picamera</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#docs">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">docs</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#mjpeg">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">mjpeg</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#usart">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOrchid;
        ">usart</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pulse">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGoldenrod;
        ">pulse</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#distance">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">distance</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#top">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkTurquoise;
        ">top</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#camera">
<span class="tag-name" style="
          font-size:0.75rem;
          color:DarkOliveGreen;
        ">camera</span>
<!--<sup class="tag-count">5</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#jinja">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">jinja</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#markdown">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateGray;
        ">markdown</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#redirect">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateGray;
        ">redirect</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#c">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkMagenta;
        ">c</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#capture">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">capture</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#bash">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGreen;
        ">bash</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#debug">
<span class="tag-name" style="
          font-size:0.75rem;
          color:DarkMagenta;
        ">debug</span>
<!--<sup class="tag-count">5</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#sensor">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkCyan;
        ">sensor</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#performance">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateGray;
        ">performance</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#h264">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">h264</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#dma">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkTurquoise;
        ">dma</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#c++">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateGray;
        ">c++</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#docker">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkTurquoise;
        ">docker</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#adc">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">adc</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#ffmpeg">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkGoldenrod;
        ">ffmpeg</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#joystick">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOrchid;
        ">joystick</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#v4l2">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateBlue;
        ">v4l2</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#timer">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkViolet;
        ">timer</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#board">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">board</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#oled">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGreen;
        ">oled</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pdf">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkCyan;
        ">pdf</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#container">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">container</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#ssd1306">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">ssd1306</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#sdcard">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateGray;
        ">sdcard</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#arm">
<span class="tag-name" style="
          font-size:1.3rem;
          color:DarkOrchid;
        ">arm</span>
<!--<sup class="tag-count">16</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#livox">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkGoldenrod;
        ">livox</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#grep">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">grep</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#python">
<span class="tag-name" style="
          font-size:0.75rem;
          color:DarkSlateGray;
        ">python</span>
<!--<sup class="tag-count">5</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#swv">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateGray;
        ">swv</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#toolchain">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">toolchain</span>
<!--<sup class="tag-count">1</sup>-->
</a>
</div>
</div>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<style>
            .md-typeset .cover {
                margin-bottom: 1em;
            }
            @media print {
                .md-typeset .cover {
                    height: 100vh;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                }
            }
        </style>
<div class="cover">
<h1 class="page-title">J-Link System View</h1>
<p class="page-description">SEGGER SystemView is a real-time recording and visualization tool for embedded systems that reveals the true runtime behavior of an application, going far deeper than the system insights provided by debuggers. This is particularly effective when developing and working with complex embedded systems comprising multiple threads and interrupts. SystemView can ensure a system performs as designed, can track down inefficiencies, and find unintended interactions and resource conflicts.</p>
<p class="page-tags">
<a class="tag" href="https://www.codeinsideout.com/tags/#arm">
<span class="tag-name">
                        #arm
                    </span>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#stm32">
<span class="tag-name">
                        #stm32
                    </span>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#debug">
<span class="tag-name">
                        #debug
                    </span>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#rtt">
<span class="tag-name">
                        #rtt
                    </span>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#sysview">
<span class="tag-name">
                        #sysview
                    </span>
</a>
</p>
<p class="md-source-date">
<hr style="margin-bottom: .5em;"/>
<small>
                            Last update:
                            <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2021-06-28 09:51:21</span>
</small>
</p>
</div>
<style>
            .md-typeset .toc {
                display: none;
            }
            .md-typeset .toc label {
                display: none;
            }
            .md-typeset .toc .md-nav {
                font-size: unset;
                line-height: 1.6;
            }
            .md-typeset .toc .md-nav--secondary {
                margin-left: -2em;
            }
            .md-typeset .toc .md-nav__list {
                margin: 0;
            }
            .md-typeset .toc ul {
                list-style: none;
            }
            @media print {
                .md-typeset .toc {
                    display: block;
                    page-break-after: always;
                }
                .md-typeset .toc .md-nav__link {
                    color: var(--md-typeset-a-color);
                }
                .md-typeset .toc .md-nav__link.md-nav__link--active {
                    font-weight: unset;
                }
            }
        </style>
<div class="toc">
<h2>Table of Content</h2>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-system-view">
    1. System View
  </a>
<nav aria-label="1. System View" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11-how-system-view-works">
    1.1. How System View Works
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12-figure-out-potential-problems">
    1.2. Figure out Potential problems
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#13-system-view-license">
    1.3. System View License
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#14-system-view-apis">
    1.4. System View APIs
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-system-view-integration">
    2. System View Integration
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-lab-analyze-a-non-os-firmware">
    3. Lab: Analyze a Non-OS firmware
  </a>
<nav aria-label="3. Lab: Analyze a Non-OS firmware" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#31-start-a-new-project">
    3.1. Start a new project
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#32-import-system-view-files">
    3.2. Import System View files
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#33-configure-system-view">
    3.3. Configure System View
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#34-print-messages-to-host">
    3.4. Print messages to host
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#35-run-the-system-view">
    3.5. Run the System View
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#36-record-interrupts">
    3.6. Record interrupts
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#37-record-a-function">
    3.7. Record a function
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#38-os-description-file">
    3.8. OS Description file
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#39-measure-performance">
    3.9. Measure performance
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-appendix">
    4. Appendix
  </a>
</li>
</ul>
</nav>
</div>
<div class="btn-actions screen-only">
<p><a class="md-button" href="..\..\..\pdfs\blog\stm32\j-link-sysview\stm32__J-Link_SysView.pdf"><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7 7-7z"></path></svg></span>PDF</a><a class="md-button" href="https://github.com/vuquangtrong/STM32-Tutorials/blob/main/Archives/F051R8_J-Link_SysView_Non-OS.zip"><span class="twemoji"><svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"></path></svg></span> F051R8 J-Link SysView NoOS</a>
<a class="md-button" href="https://github.com/vuquangtrong/STM32-Tutorials/blob/main/Archives/F411CE_J-Link_SysView_Non-OS.zip"><span class="twemoji"><svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"></path></svg></span> F411CE J-Link SysView NoOS</a>
<a class="md-button" href="SEGGER_SysView_V330.zip"><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7 7-7z"></path></svg></span> SEGGER_SysView_V330.zip</a></p>
</div>
<h2 id="1-system-view">1. System View<a class="headerlink" href="#1-system-view" title="Permanent link"></a></h2>
<div class="admonition info nt">
<p class="admonition-title"></p>
<p>Visit the <a href="https://www.segger.com/products/development-tools/systemview/">Official J-Link System View page</a> on SEGGER website for more information.</p>
</div>
<p><a class="md-button" href="https://www.segger.com/downloads/free-utilities/UM08027"><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7 7-7z"></path></svg></span> J-Link System View - Manual</a></p>
<p>SEGGERs J-Link System View is written on top of the excellent <a href="../j-link-rtt/">J-Link Real-Time Transfer</a> to record many types of events in real-time in an embedded system. Those events can be interrupts, timers, task switches and scheduling with an RTOS, API function calls and returns, or user events and messages. The events are retrieved from the target, analyzed and visualized in the <a href="https://www.segger.com/downloads/systemview/">SystemView Application</a>, while the target keeps running.</p>
<h3 id="11-how-system-view-works">1.1. How System View Works<a class="headerlink" href="#11-how-system-view-works" title="Permanent link"></a></h3>
<p>To keep the communication overhead on the target system low, it only needs to record basic information, such as API function with Id <em>X</em> has been called with parameter values <em>y</em> and <em>z</em> at the <em>n</em> ticks after the last event. SystemView analyzes all information from the events and shows:</p>
<ul>
<li>The recording time or system time when the call happened</li>
<li>The task/context in which the call happened</li>
<li>The interrupt name, timer ID, and marker name</li>
<li>The API function name and its parameters and values</li>
<li>The duration of the any pair of start-stop, enter-exit events</li>
</ul>
<div class="admonition info nt">
<p class="admonition-title"></p>
<p>The timestamps for events can be as accurate as 1 CPU cycle. A regular event is just 4 to 8 bytes long.</p>
</div>
<h3 id="12-figure-out-potential-problems">1.2. Figure out Potential problems<a class="headerlink" href="#12-figure-out-potential-problems" title="Permanent link"></a></h3>
<p><strong>Issues and inefficiencies</strong> in the system can be identified below ways:</p>
<ul>
<li>Incorrect task priorities or priority inversion leading to starvation</li>
<li>Incorrect inter-task communication</li>
<li>Inefficient delays and timeouts</li>
<li>Spurious or unnecessary interrupts</li>
<li>Unexpected log run-time of a short task</li>
</ul>
<p><strong>High CPU Load</strong> can lead to:</p>
<ul>
<li>Bottlenecks which may lead to delayed execution of important tasks</li>
<li>Dropped data or overflow of incoming buffer</li>
</ul>
<h3 id="13-system-view-license">1.3. System View License<a class="headerlink" href="#13-system-view-license" title="Permanent link"></a></h3>
<p>SystemView may be used with a non-commercial license for evaluation, educational and
hobbyist purposes. When using SystemView under the non-commercial license, no activation is required. On start of the SystemView Application, a popup is presented, the click <strong>Continue</strong> to accept the license terms.</p>
<p>
<figure><img src="sysview_license_popup.png"/><figcaption>No Commercial-Use License</figcaption>
</figure>
</p>
<h3 id="14-system-view-apis">1.4. System View APIs<a class="headerlink" href="#14-system-view-apis" title="Permanent link"></a></h3>
<p>The SEGGER System View implementation is written in ANSI C on the top of RTT, therefore, it can be easily integrated into any embedded application. The System View needs to be initialized before it can be used. However, it does not automatically run to reduce CPU Load and power usage. System View only runs when it gets request from Hosts System View Application.</p>
<p><br/>
<strong>Control functions</strong></p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SEGGER_SYSVIEW_Init()</code></td>
<td>Initializes the SYSVIEW module</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_Start()</code></td>
<td>Start recording SystemView events. This function is triggered by the SystemView Application on connect.</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_Stop()</code></td>
<td>Stop recording SystemView events. This function is triggered by the SystemView Application on disconnect.</td>
</tr>
</tbody>
</table>
<p><br/>
<strong>Configuration functions</strong></p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SEGGER_SYSVIEW_Conf()</code></td>
<td>Initialize and configures SystemView</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_SetRAMBase()</code></td>
<td>Sets the RAM base address</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_SendSysDesc()</code></td>
<td>Send the system description string to the host</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_SendTaskList()</code></td>
<td>Send all tasks descriptors to the host</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_SendTaskInfo()</code></td>
<td>Send a Task Info Packet, containing TaskId for identification, task priority and task name</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_X_GetTimestamp()</code></td>
<td>Callback called by SystemView to get the timestamp in cycles</td>
</tr>
</tbody>
</table>
<p><br/>
<strong>Event recording functions</strong></p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SEGGER_SYSVIEW_RecordEnterISR()</code></td>
<td>Format and send an ISR entry event</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_RecordExitISR()</code></td>
<td>Format and send an ISR exit event</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_RecordEnterTimer()</code></td>
<td>Format and send a Timer entry event</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_RecordExitTimer()</code></td>
<td>Format and send a Timer exit event</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_OnIdle()</code></td>
<td>Record an Idle event</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_OnTaskCreate()</code></td>
<td>Record a Task Create event</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_OnTaskStartExec()</code></td>
<td>Record a Task Start Execution event</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_OnTaskStartReady()</code></td>
<td>Record a Task Start Ready event</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_OnTaskStopExec()</code></td>
<td>Record a Task Stop Execution event</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_OnTaskStopReady()</code></td>
<td>Record a Task Stop Ready event</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_OnTaskTerminate()</code></td>
<td>Record a Task termination event</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_MarkStart()</code></td>
<td>Record a Performance Marker Start event to start measuring runtime</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_Mark()</code></td>
<td>Record a Performance Marker intermediate event</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_MarkStop()</code></td>
<td>Record a Performance Marker Stop event to stop measuring runtime</td>
</tr>
</tbody>
</table>
<p><br/>
<strong>User API recording functions</strong></p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SEGGER_SYSVIEW_RecordVoid()</code></td>
<td>Formats and sends a SystemView packet with an empty payload</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_RecordU32()</code></td>
<td>Formats and sends a SystemView packet containing a single U32 parameter payload</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_RecordU32x[2:10]()</code></td>
<td>Formats and sends a SystemView packet containing [2:10] U32 parameter payload</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_RecordString()</code></td>
<td>Formats and sends a SystemView packet containing a string</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_RecordEndCall()</code></td>
<td>Format and send an End API Call event without return value.</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_RecordEndCallU32()</code></td>
<td>Format and send an End API Call event with a return value</td>
</tr>
</tbody>
</table>
<p><br/>
<strong>Message recording functions</strong></p>
<table>
<thead>
<tr>
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SEGGER_SYSVIEW_Print()</code></td>
<td>Print a string to the host</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_Warn()</code></td>
<td>Print a warning string to the host</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_Error()</code></td>
<td>Print an error string to the host</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_PrintfHost()</code></td>
<td>Print a string which is formatted on the host by the SystemView Application</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_WarnfHost()</code></td>
<td>Print a string which is formatted on the host by the SystemView Application</td>
</tr>
<tr>
<td><code>SEGGER_SYSVIEW_ErrorfHost()</code></td>
<td>Print an error string which is formatted on the host by the SystemView Application</td>
</tr>
</tbody>
</table>
<div class="admonition info nt">
<p class="admonition-title"></p>
<p>To reduce CPU cycles used by System View to format strings, System View function <code>*fHost()</code> just sends a raw string and its params to the host!</p>
</div>
<h2 id="2-system-view-integration">2. System View Integration<a class="headerlink" href="#2-system-view-integration" title="Permanent link"></a></h2>
<p>Install the System View Application firstly at <a href="https://www.segger.com/downloads/systemview/">System View download page</a>.
After installation, go the application folder to get the latest source code of System View target integration, for example <code>C:\Program Files\SEGGER\SystemView\Src</code>. Here is <a href="SEGGER_SysView_V330.zip">SEGGER_SysView_V330.zip</a>.</p>
<div class="highlight"><pre><span></span><code>Config
     Global.h                          <span class="c1"># Typedef for data types</span>
     SEGGER_RTT_Conf.h                 <span class="c1"># Default RTT configs</span>
     SEGGER_SYSVIEW_Conf.h             <span class="c1"># User SysView Configs</span>
<span class="p">|</span>
SEGGER
     SEGGER.h                         <span class="c1"># Segger common defines</span>
     SEGGER_RTT.h                     <span class="c1"># RTT Header</span>
     SEGGER_RTT.c                     <span class="c1"># RTT implementation</span>
     SEGGER_RTT_ASM_ARMv7M.S          <span class="c1"># for Cortex-M3/M4</span>
     SEGGER_RTT_printf.c              <span class="c1"># Print functions</span>
     SEGGER_SYSVIEW_ConfDefaults.h    <span class="c1"># SysView Default Configs</span>
     SEGGER_SYSVIEW_Int.h             <span class="c1"># SysView Internal defines</span>
     SEGGER_SYSVIEW.h                 <span class="c1"># SysView header</span>
     SEGGER_SYSVIEW.c                 <span class="c1"># SysView implementation</span>
  
  Syscalls                         <span class="c1"># Standard IO redirection</span>

Sample                                <span class="c1"># Sample configs for diff. targets</span>
  COMM                              <span class="c1"># Example to record on UART</span>
  embOS                             <span class="c1"># Example configs</span>
  FreeRTOSV10                       <span class="c1"># Example configs</span>
  FreeRTOSV8                        <span class="c1"># Example configs</span>
  FreeRTOSV9                        <span class="c1"># Example configs</span>
  MicriumOSKernel                   <span class="c1"># Example configs</span>
  uCOS-II                           <span class="c1"># Example configs</span>
  uCOS-III                          <span class="c1"># Example configs</span>
  NoOS                              <span class="c1"># Example configs</span>
     Config
         RX
         Cortex-M
                SEGGER_SYSVIEW_Config_NoOS.c
         Cortex-M0
                 SEGGER_SYSVIEW_Config_NoOS_CM0.c
</code></pre></div>
<div class="admonition note nt">
<p class="admonition-title"></p>
<p>To integrate System View into a project,its recommend to put header files into <code>Inc</code> folder, and all source file into <code>Src</code> folder, as they will need to add into Builds Path and Symbols.</p>
</div>
<h2 id="3-lab-analyze-a-non-os-firmware">3. Lab: Analyze a Non-OS firmware<a class="headerlink" href="#3-lab-analyze-a-non-os-firmware" title="Permanent link"></a></h2>
<p>This lab will guide on how to add System View into an application and record its activity to analyse them.</p>
<p>As System View is based on RTT which runs through SWD interface, the guide to integrate on Cortex-M MCUs is the same in general. There are some steps needed for specific CPU lines, as can be seen in the Sample files of SEGGER.</p>
<div class="np"></div>
<p><strong>Target application</strong></p>
<ul>
<li>Blink an LED at 100 Hz using a general Timer</li>
<li>Increase a counter value by one when press on a Button using External Interrupt</li>
<li>Send the above counter value on an UART port every 100 ms in the main loop</li>
</ul>
<h3 id="31-start-a-new-project">3.1. Start a new project<a class="headerlink" href="#31-start-a-new-project" title="Permanent link"></a></h3>
<p>This guide is written based on projects with STM32F051R8 (Cortex-M0) as it needs more configs then other Cortex-M MCUs.</p>
<p>Here are settings applied to a new project before starting to add System View:</p>
<ol>
<li>Check if need to enable HSE or LSE when using external crystals</li>
<li>Setup debug mode for using SWD on <strong>PA13</strong> (SWDIO) and <strong>PA14</strong> (SWCLK)</li>
<li>Setup Clock path, PLL, and the system frequency</li>
<li>Enable <strong>UART1</strong>, set baud rate at 115200 bps, mode 8-N-1, and enable its interrupt</li>
<li>Enable the general purpose timer, e.g. <strong>TIM3</strong>, and set to use internal system clock, interrupt at 100 Hz</li>
<li>Config a button input of <strong>PA0</strong> with External Interrupt mode</li>
<li>Config a LED outputs on any available GPIO pin, e.g. <strong>PC8</strong> or <strong>PC13</strong></li>
</ol>
<p>Here is the base code of the in the <code>main.c</code> file for this applications requirement:</p>
<div class="file"></div>
<p>main.c</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;string.h&gt;</span><span class="cp"></span>

<span class="n">TIM_HandleTypeDef</span> <span class="n">htim3</span><span class="p">;</span>
<span class="n">UART_HandleTypeDef</span> <span class="n">huart1</span><span class="p">;</span>

<span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span> <span class="c1">// counter=xxx\r\n</span>

<span class="kt">void</span> <span class="nf">SystemClock_Config</span><span class="p">(</span><span class="kt">void</span><span class="p">){...}</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">MX_GPIO_Init</span><span class="p">(</span><span class="kt">void</span><span class="p">){...}</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">MX_USART1_UART_Init</span><span class="p">(</span><span class="kt">void</span><span class="p">){...}</span>
<span class="k">static</span> <span class="kt">void</span> <span class="nf">MX_TIM3_Init</span><span class="p">(</span><span class="kt">void</span><span class="p">){...}</span>

<span class="kt">void</span> <span class="nf">HAL_TIM_PeriodElapsedCallback</span><span class="p">(</span><span class="n">TIM_HandleTypeDef</span> <span class="o">*</span><span class="n">htim</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">htim</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">htim3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">HAL_GPIO_TogglePin</span><span class="p">(</span><span class="n">LED_GPIO_Port</span><span class="p">,</span> <span class="n">LED_Pin</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>



<span class="kt">void</span> <span class="nf">HAL_GPIO_EXTI_Callback</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">GPIO_Pin</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">GPIO_Pin</span> <span class="o">==</span> <span class="n">GPIO_PIN_0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">counter</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HAL_UART_TxCpltCallback</span><span class="p">(</span><span class="n">UART_HandleTypeDef</span> <span class="o">*</span><span class="n">huart</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">huart</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">huart1</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">}</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">HAL_Init</span><span class="p">();</span>
  <span class="n">SystemClock_Config</span><span class="p">();</span>
  <span class="n">MX_GPIO_Init</span><span class="p">();</span>
  <span class="n">MX_USART1_UART_Init</span><span class="p">();</span>
  <span class="n">MX_TIM3_Init</span><span class="p">();</span>

  <span class="n">HAL_TIM_Base_Start_IT</span><span class="p">(</span><span class="o">&amp;</span><span class="n">htim3</span><span class="p">);</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"counter = %03d</span><span class="se">\r\n</span><span class="s">"</span><span class="p">,</span> <span class="n">counter</span><span class="p">);</span>
    <span class="n">HAL_UART_Transmit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">huart1</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">buffer</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span>
                        <span class="n">HAL_MAX_DELAY</span><span class="p">);</span>
    <span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>When start up, this application prints out <code>counter = 000</code> every 100 ms. If press on the Button, the counter value is increased, not always by 1, but sometimes by 3, 4, or more, due to un-debounced input.</p>
<h3 id="32-import-system-view-files">3.2. Import System View files<a class="headerlink" href="#32-import-system-view-files" title="Permanent link"></a></h3>
<p>The base files of SEGGER System View can be added in a separated folder <code>Segger</code>, and custom config files can can be added into the project main folder. See the below folder structure:</p>
<div class="admonition caution">
<p class="admonition-title">Sample files</p>
<p>SEGGER provides Sample files for different types of OS and CPU. Make sure to include correct header and source files for the target project.</p>
<p>Read the System View Manual for more details of each type of OS and CPU support.</p>
</div>
<p>This project is for STM32F051R8 MCU which is based on Cortex-M0 CPU, therefore, the file <code>SEGGER_SYSVIEW_Config_NoOS_CM0.c</code> will be included.</p>
<p><strong>Add Include Paths</strong></p>
<p>Open the <strong>Project Properties</strong> and select <strong>C/C++ Build</strong>  <strong>Settings</strong>. Then add <code>../Segger/Inc</code> into the include paths of both GCC Assembler and GCC Compiler</p>
<div class="row">
<div class="col">
<p>
<figure><img src="led_add_segger_sysview.png"/><figcaption></figcaption>
</figure>
</p>
</div>
<div class="col">
<p>
<figure><img src="lab_add_segger_sysview_2.png"/><figcaption></figcaption>
</figure>
</p>
</div>
</div>
<p>
<figure><img src="lab_include_path.png"/><figcaption>Add Include path</figcaption>
</figure>
</p>
<p><strong>Add source files</strong></p>
<p>To make System View source files get compiled, add the folder <code>/Segger</code> into the <strong>Source Location</strong> list in the <strong>Paths and Symbols</strong> setting under the <strong>C/C++ General</strong> property.</p>
<p>
<figure><img src="lab_source_location.png"/><figcaption>Add source files</figcaption>
</figure>
</p>
<h3 id="33-configure-system-view">3.3. Configure System View<a class="headerlink" href="#33-configure-system-view" title="Permanent link"></a></h3>
<p>Before System View can be used, it needs to be initialized, including:</p>
<ul>
<li>Setup RTT base</li>
<li>Set RAM Base address</li>
<li>Send Device Information</li>
<li>Send Interrupts description</li>
<li>Set Timestamp source</li>
</ul>
<p>In the <code>main.c</code>, include the SEGGER System View header files, then in the <code>main()</code> function, call to <code>SEGGER_SYSVIEW_Conf()</code> function to initialize the System View stuff:</p>
<div class="file"></div>
<p>main.c</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">"SEGGER_SYSVIEW_Conf.h"</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">"SEGGER_SYSVIEW.h"</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">SEGGER_SYSVIEW_Conf</span><span class="p">();</span> <span class="c1">// initialize SystemView</span>
    <span class="k">while</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{...}</span>
<span class="p">}</span>
</code></pre></div>
<p>Normally, <code>SEGGER_SYSVIEW_Conf()</code> will initialize the System View with System Clock Frequency (saved in <code>SystemCoreClock</code> variable) for timestamp resolution, and provide a <code>_cbSendSystemDesc()</code> callback function which will be executed when the host application requests to start monitoring. The device information have to be sent to host application, with custom data, therefore it is implemented in the <code>SEGGER_SYSVIEW_Config_NoOS_CM0.c</code>.</p>
<p>The next step is to set the RAM Base address. Every variables address will be subtracted to this base address to get an offset value which is later encoded in only 1 or 2 bytes. The RAM Base address for ARM all Cortex-M MCUs is <code>0x20000000</code>:</p>
<div class="file"></div>
<p>SEGGER_SYSVIEW_Config_NoOS_CM0.c</p>
<div class="highlight"><pre><span></span><code><span class="cp">#define SYSVIEW_RAM_BASE        (0x20000000)</span>
</code></pre></div>
<p>Here is the <code>SEGGER_SYSVIEW_Conf()</code> function:</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">SEGGER_SYSVIEW_Conf</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">SEGGER_SYSVIEW_Init</span><span class="p">(</span><span class="n">SYSVIEW_TIMESTAMP_FREQ</span><span class="p">,</span> <span class="n">SYSVIEW_CPU_FREQ</span><span class="p">,</span>
                        <span class="mi">0</span><span class="p">,</span> <span class="n">_cbSendSystemDesc</span><span class="p">);</span>
    <span class="n">SEGGER_SYSVIEW_SetRAMBase</span><span class="p">(</span><span class="n">SYSVIEW_RAM_BASE</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>Next step is to implement the callback function <code>_cbSendSystemDesc()</code> which sends the Device information, including the App Name, the Device Name, the Core Name, the OS Name, and the interrupts used in the application:</p>
<div class="file"></div>
<p>SEGGER_SYSVIEW_Config_NoOS_CM0.c</p>
<div class="highlight"><pre><span></span><code><span class="cp">#define SYSVIEW_APP_NAME        "System View Demo"</span>
<span class="cp">#define SYSVIEW_DEVICE_NAME     "STM32F051R8"</span>
<span class="cp">#define SYSVIEW_CORE_NAME       "Cortex-M0"</span>
<span class="cp">#define SYSVIEW_OS_NAME         "Non-OS_Cortex-M0"</span>

<span class="k">static</span> <span class="kt">void</span> <span class="nf">_cbSendSystemDesc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SEGGER_SYSVIEW_SendSysDesc</span><span class="p">(</span><span class="s">"N="</span><span class="n">SYSVIEW_APP_NAME</span><span class="s">","</span>
                             <span class="s">"D="</span><span class="n">SYSVIEW_DEVICE_NAME</span><span class="s">","</span>
                             <span class="s">"C="</span><span class="n">SYSVIEW_CORE_NAME</span><span class="s">","</span>
                             <span class="s">"O="</span><span class="n">SYSVIEW_OS_NAME</span><span class="p">);</span>
  <span class="n">SEGGER_SYSVIEW_SendSysDesc</span><span class="p">(</span><span class="s">"I#15=SysTick"</span><span class="p">);</span>
  <span class="n">SEGGER_SYSVIEW_SendSysDesc</span><span class="p">(</span><span class="s">"I#21=EXTI0_1_IRQHandler"</span><span class="p">);</span>
  <span class="n">SEGGER_SYSVIEW_SendSysDesc</span><span class="p">(</span><span class="s">"I#32=TIM3_IRQHandler"</span><span class="p">);</span>
  <span class="n">SEGGER_SYSVIEW_SendSysDesc</span><span class="p">(</span><span class="s">"I#43=USART1_IRQHandler"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition info nt">
<p class="admonition-title"></p>
<p>The <em>OS Name</em>  also is used by System View Application to load useful descriptions for displaying analysed data. Read more in <a href="#">APIs Descriptions</a>.</p>
<p>The Interrupt number can be found in the <code>g_pfnVectors</code> table in the <code>startup_stm32f051r8tx.s</code>. Different cores have different interrupt mapping, even some interrupts remain the same number, e.g. the interrupt <code>SysTick_Handler</code> always is mapped to the number #15. Application should only send in-use interrupts to the host. The main loop, and each interrupt is considered as a different context.</p>
<div class="highlight"><pre><span></span><code><span class="nl">g_pfnVectors</span><span class="p">:</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">_estack</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">Reset_Handler</span>                     <span class="cm">/*  1 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">NMI_Handler</span>                       <span class="cm">/*  2 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">HardFault_Handler</span>                 <span class="cm">/*  3 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="mi">0</span>                                 <span class="cm">/*  4 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="mi">0</span>                                 <span class="cm">/*  5 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="mi">0</span>                                 <span class="cm">/*  6 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="mi">0</span>                                 <span class="cm">/*  7 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="mi">0</span>                                 <span class="cm">/*  8 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="mi">0</span>                                 <span class="cm">/*  9 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="mi">0</span>                                 <span class="cm">/* 10 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">SVC_Handler</span>                       <span class="cm">/* 11 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="mi">0</span>                                 <span class="cm">/* 12 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="mi">0</span>                                 <span class="cm">/* 13 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">PendSV_Handler</span>                    <span class="cm">/* 14 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">SysTick_Handler</span>                   <span class="cm">/* 15 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">WWDG_IRQHandler</span>                   <span class="cm">/* 16 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">PVD_IRQHandler</span>                    <span class="cm">/* 17 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">RTC_IRQHandler</span>                    <span class="cm">/* 18 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">FLASH_IRQHandler</span>                  <span class="cm">/* 19 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">RCC_CRS_IRQHandler</span>                <span class="cm">/* 20 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">EXTI0_1_IRQHandler</span>                <span class="cm">/* 21 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">EXTI2_3_IRQHandler</span>                <span class="cm">/* 22 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">EXTI4_15_IRQHandler</span>               <span class="cm">/* 23 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">TSC_IRQHandler</span>                    <span class="cm">/* 24 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">DMA1_Channel1_IRQHandler</span>          <span class="cm">/* 25 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">DMA1_Channel2_3_IRQHandler</span>        <span class="cm">/* 26 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">DMA1_Channel4_5_IRQHandler</span>        <span class="cm">/* 27 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">ADC1_COMP_IRQHandler</span>              <span class="cm">/* 28 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">TIM1_BRK_UP_TRG_COM_IRQHandler</span>    <span class="cm">/* 29 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">TIM1_CC_IRQHandler</span>                <span class="cm">/* 30 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">TIM2_IRQHandler</span>                   <span class="cm">/* 31 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">TIM3_IRQHandler</span>                   <span class="cm">/* 32 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">TIM6_DAC_IRQHandler</span>               <span class="cm">/* 33 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="mi">0</span>                                 <span class="cm">/* 34 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">TIM14_IRQHandler</span>                  <span class="cm">/* 35 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">TIM15_IRQHandler</span>                  <span class="cm">/* 36 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">TIM16_IRQHandler</span>                  <span class="cm">/* 37 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">TIM17_IRQHandler</span>                  <span class="cm">/* 38 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">I2C1_IRQHandler</span>                   <span class="cm">/* 39 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">I2C2_IRQHandler</span>                   <span class="cm">/* 40 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">SPI1_IRQHandler</span>                   <span class="cm">/* 41 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">SPI2_IRQHandler</span>                   <span class="cm">/* 42 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">USART1_IRQHandler</span>                 <span class="cm">/* 43 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">USART2_IRQHandler</span>                 <span class="cm">/* 44 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="mi">0</span>                                 <span class="cm">/* 45 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="n">CEC_CAN_IRQHandler</span>                <span class="cm">/* 46 */</span>
    <span class="p">.</span><span class="n">word</span>  <span class="mi">0</span>                                 <span class="cm">/* 47 */</span>
</code></pre></div>
</div>
<p>The final step is to help System View find the system timestamp which is used in all events for processing the timeline of recorded events.</p>
<p>For Cortex-M0, it is needed to increase the variable <code>SEGGER_SYSVIEW_TickCnt</code> in the SysTick interrupt, as soon as that handler is executed. This variable is used in the function <code>SEGGER_SYSVIEW_X_GetTimestamp()</code> to correctly calculate the clock cycles.</p>
<div class="np"></div>
<div class="file"></div>
<p>stm32f0xx_it</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span> <span class="cpf">"SEGGER_SYSVIEW.h"</span><span class="cp"></span>
<span class="kt">void</span> <span class="nf">SysTick_Handler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">SEGGER_SYSVIEW_TickCnt</span><span class="o">++</span><span class="p">;</span>
  <span class="n">HAL_IncTick</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition note">
<p class="admonition-title">Cycle counter</p>
<p>Except on Cortex-M0 MCUs do not have Cycle Counter, therefore, it needs to be calculated manually based on the SysTick interrupt and the SysTick reload register. Other Cortex-M CPU has CPU Cycle Counter register to be used as system timestamp. Both of two methods provide 1-cycle resolution.</p>
</div>
<h3 id="34-print-messages-to-host">3.4. Print messages to host<a class="headerlink" href="#34-print-messages-to-host" title="Permanent link"></a></h3>
<p>To log the <code>counter</code> value to both the UART1 interface and the System View application, add the function all <code>SEGGER_SYSVIEW_Print()</code> which sends a string to the host:</p>
<div class="file"></div>
<p>main.c</p>
<div class="highlight"><pre><span></span><code><span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"counter = %03d</span><span class="se">\r\n</span><span class="s">"</span><span class="p">,</span> <span class="n">counter</span><span class="p">);</span>
    <span class="n">HAL_UART_Transmit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">huart1</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">buffer</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span>
                        <span class="n">HAL_MAX_DELAY</span><span class="p">);</span>
<span class="hll">    <span class="n">SEGGER_SYSVIEW_Print</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
</span>    <span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="35-run-the-system-view">3.5. Run the System View<a class="headerlink" href="#35-run-the-system-view" title="Permanent link"></a></h3>
<p><mark>Connect any J-Link probe</mark> into the SWD interface of the target MCU. Then start the System View application on the host PC.</p>
<div class="row">
<div class="col w40">
<p>
<figure class="w65"><img src="J-LINK_PRO.png"/><figcaption>J-Link Pro</figcaption></figure>
</p>
</div>
<div class="col w60">
<p>
<figure class="w50"><img src="Clone_J-Link_OB_v2.png"/><figcaption>Cloned J-Link OB</figcaption></figure>
</p>
</div>
</div>
<div class="row">
<div class="col">
<p>
<figure><img src="j-link_jtag_connection.png"/><figcaption>J-Link JTAG connection</figcaption>
</figure>
</p>
</div>
<div class="col">
<p>
<figure><img src="j-link_swd_connection.png"/><figcaption>J-Link SWD connection</figcaption>
</figure>
</p>
</div>
</div>
<div class="admonition info">
<p class="admonition-title">Convert ST-LINK to J-LINK</p>
<p>SEGGER offers a <a href="https://www.segger.com/products/debug-probes/j-link/models/other-j-links/st-link-on-board/">firmware upgrading</a> the ST-LINK on-board on the Nucleo and Discovery Boards to a J-LINK On-Board debugger.</p>
</div>
<p>Start the System View for the first time, it will show a recorded example. Go to <strong>Tools</strong>  <strong>Preferences</strong> and uncheck the checkbox <strong>Load last data on start</strong>.</p>
<p>When starting to record a new session, it is recommended to check and set the target device. Press <code>Alt + Return</code> to show the device selection:</p>
<p>
<figure class="w40"><img src="lab_device_selection.png"/><figcaption>Device selection</figcaption></figure>
</p>
<p>Press <code>F5</code> or click on the start button to start recording. At the beginning step in this lab, the System View will display:</p>
<ul>
<li>Device information which are set above</li>
<li>The message of counter value every 100 ms</li>
</ul>
<p>
<figure><img src="lab_sysview_device_info.png"/><figcaption>System View with device info and some messages</figcaption>
</figure>
</p>
<h3 id="36-record-interrupts">3.6. Record interrupts<a class="headerlink" href="#36-record-interrupts" title="Permanent link"></a></h3>
<p>In the file <code>stm32f0xx_it.c</code>, in each concerning interrupt handler, add a pair of ISR recording function <code>SEGGER_SYSVIEW_RecordEnterISR()</code> and <code>SEGGER_SYSVIEW_RecordExitISR()</code> to track the interrupts. It automatically retrieves the interrupt ID via an special register implemented in the <code>SEGGER_SYSVIEW_GET_INTERRUPT_ID()</code> function macro:</p>
<div class="file"></div>
<p>main.c</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">SysTick_Handler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SEGGER_SYSVIEW_TickCnt</span><span class="o">++</span><span class="p">;</span> <span class="c1">// must be at the beginning</span>
<span class="hll">  <span class="n">SEGGER_SYSVIEW_RecordEnterISR</span><span class="p">();</span>
</span>  <span class="n">HAL_IncTick</span><span class="p">();</span>
<span class="hll">  <span class="n">SEGGER_SYSVIEW_RecordExitISR</span><span class="p">();</span>
</span><span class="p">}</span>

<span class="kt">void</span> <span class="nf">EXTI0_1_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SEGGER_SYSVIEW_RecordEnterISR</span><span class="p">();</span>
  <span class="n">HAL_GPIO_EXTI_IRQHandler</span><span class="p">(</span><span class="n">GPIO_PIN_0</span><span class="p">);</span>
  <span class="n">SEGGER_SYSVIEW_RecordExitISR</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">TIM3_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SEGGER_SYSVIEW_RecordEnterISR</span><span class="p">();</span>
  <span class="n">HAL_TIM_IRQHandler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">htim3</span><span class="p">);</span>
  <span class="n">SEGGER_SYSVIEW_RecordExitISR</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">USART1_IRQHandler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SEGGER_SYSVIEW_RecordEnterISR</span><span class="p">();</span>
  <span class="n">HAL_UART_IRQHandler</span><span class="p">(</span><span class="o">&amp;</span><span class="n">huart1</span><span class="p">);</span>
  <span class="n">SEGGER_SYSVIEW_RecordExitISR</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<p>This time, when recording with System View, there are many events captured. Below is a screenshot of the moment I pressed on the BUTTON once, which does not have a de-bouncing filter, there were a lot of ISRs triggered. That explains why the <code>counter</code> variable were increased multiple times.</p>
<p>
<figure><img src="lab_sysview_interrupts.png"/><figcaption>System View with Interrupt context</figcaption>
</figure>
</p>
<h3 id="37-record-a-function">3.7. Record a function<a class="headerlink" href="#37-record-a-function" title="Permanent link"></a></h3>
<p>Its known that the HAL IRQs take care a lot of user cases, which indeed causes wasting time, before it calls to an users callback function.</p>
<p>The System View records the enter and the exit event of an interrupt, but it does not automatically record an user function. To do that, application must manually set the starting point of the functions entry with one of:</p>
<ul>
<li><code>SEGGER_SYSVIEW_RecordVoid()</code>, or</li>
<li><code>SEGGER_SYSVIEW_RecordU32()</code>, or</li>
<li><code>SEGGER_SYSVIEW_RecordString()</code></li>
</ul>
<p>and the ending point of that function with one of:</p>
<ul>
<li><code>SEGGER_SYSVIEW_RecordEndCall()</code>, or</li>
<li><code>SEGGER_SYSVIEW_RecordEndCallU32()</code> function.</li>
</ul>
<p>These functions need an ID to distinguish the different APIs. ID is 2 bytes, comparing to a API function name which usually is much more than 2 bytes, it is very short to save sending bandwidth.</p>
<p>For example, to measure the main loop, and user callback functions, define some IDs starting from 32 as below:</p>
<div class="file"></div>
<p>SEGGER_SYSVIEW_Conf.h</p>
<div class="highlight"><pre><span></span><code><span class="cp">#define APP_EVTID_MAIN_LOOP                       32</span>
<span class="cp">#define APP_EVTID_HAL_TIM_PeriodElapsedCallback   33</span>
<span class="cp">#define APP_EVTID_HAL_GPIO_EXTI_Callback          34</span>
<span class="cp">#define APP_EVTID_HAL_UART_TxCpltCallback         35</span>
</code></pre></div>
<div class="file"></div>
<p>main.c</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">HAL_TIM_PeriodElapsedCallback</span><span class="p">(</span><span class="n">TIM_HandleTypeDef</span> <span class="o">*</span><span class="n">htim</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SEGGER_SYSVIEW_RecordVoid</span><span class="p">(</span><span class="n">APP_EVTID_HAL_TIM_PeriodElapsedCallback</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">htim</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">htim3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">HAL_GPIO_TogglePin</span><span class="p">(</span><span class="n">LED_GPIO_Port</span><span class="p">,</span> <span class="n">LED_Pin</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">SEGGER_SYSVIEW_RecordEndCall</span><span class="p">(</span><span class="n">APP_EVTID_HAL_TIM_PeriodElapsedCallback</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HAL_GPIO_EXTI_Callback</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">GPIO_Pin</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SEGGER_SYSVIEW_RecordVoid</span><span class="p">(</span><span class="n">APP_EVTID_HAL_GPIO_EXTI_Callback</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">GPIO_Pin</span> <span class="o">==</span> <span class="n">GPIO_PIN_0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">counter</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">SEGGER_SYSVIEW_RecordEndCall</span><span class="p">(</span><span class="n">APP_EVTID_HAL_GPIO_EXTI_Callback</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">HAL_UART_TxCpltCallback</span><span class="p">(</span><span class="n">UART_HandleTypeDef</span> <span class="o">*</span><span class="n">huart</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SEGGER_SYSVIEW_RecordVoid</span><span class="p">(</span><span class="n">APP_EVTID_HAL_UART_TxCpltCallback</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">huart</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">huart1</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">}</span>
  <span class="n">SEGGER_SYSVIEW_RecordEndCall</span><span class="p">(</span><span class="n">APP_EVTID_HAL_UART_TxCpltCallback</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">SEGGER_SYSVIEW_RecordVoid</span><span class="p">(</span><span class="n">APP_EVTID_MAIN_LOOP</span><span class="p">);</span>
        <span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"counter = %03d</span><span class="se">\r\n</span><span class="s">"</span><span class="p">,</span> <span class="n">counter</span><span class="p">);</span>
        <span class="n">HAL_UART_Transmit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">huart1</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">buffer</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span>
                            <span class="n">HAL_MAX_DELAY</span><span class="p">);</span>
        <span class="n">SEGGER_SYSVIEW_Print</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
        <span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
        <span class="n">SEGGER_SYSVIEW_RecordEndCall</span><span class="p">(</span><span class="n">APP_EVTID_MAIN_LOOP</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<div class="admonition info">
<p class="admonition-title">System View reserved IDs</p>
<p>The first 32 IDs from 0 to 31 are reserved by System View for its defined events:</p>
<div class="file"></div>
<p>SEGGER_SYSVIEW.h</p>
<div class="highlight"><pre><span></span><code><span class="cp">#define   SYSVIEW_EVTID_NOP                0  </span><span class="c1">// Dummy packet.</span>
<span class="cp">#define   SYSVIEW_EVTID_OVERFLOW           1</span>
<span class="cp">#define   SYSVIEW_EVTID_ISR_ENTER          2</span>
<span class="cp">#define   SYSVIEW_EVTID_ISR_EXIT           3</span>
<span class="cp">#define   SYSVIEW_EVTID_TASK_START_EXEC    4</span>
<span class="cp">#define   SYSVIEW_EVTID_TASK_STOP_EXEC     5</span>
<span class="cp">#define   SYSVIEW_EVTID_TASK_START_READY   6</span>
<span class="cp">#define   SYSVIEW_EVTID_TASK_STOP_READY    7</span>
<span class="cp">#define   SYSVIEW_EVTID_TASK_CREATE        8</span>
<span class="cp">#define   SYSVIEW_EVTID_TASK_INFO          9</span>
<span class="cp">#define   SYSVIEW_EVTID_TRACE_START       10</span>
<span class="cp">#define   SYSVIEW_EVTID_TRACE_STOP        11</span>
<span class="cp">#define   SYSVIEW_EVTID_SYSTIME_CYCLES    12</span>
<span class="cp">#define   SYSVIEW_EVTID_SYSTIME_US        13</span>
<span class="cp">#define   SYSVIEW_EVTID_SYSDESC           14</span>
<span class="cp">#define   SYSVIEW_EVTID_MARK_START        15</span>
<span class="cp">#define   SYSVIEW_EVTID_MARK_STOP         16</span>
<span class="cp">#define   SYSVIEW_EVTID_IDLE              17</span>
<span class="cp">#define   SYSVIEW_EVTID_ISR_TO_SCHEDULER  18</span>
<span class="cp">#define   SYSVIEW_EVTID_TIMER_ENTER       19</span>
<span class="cp">#define   SYSVIEW_EVTID_TIMER_EXIT        20</span>
<span class="cp">#define   SYSVIEW_EVTID_STACK_INFO        21</span>
<span class="cp">#define   SYSVIEW_EVTID_MODULEDESC        22</span>

<span class="cp">#define   SYSVIEW_EVTID_INIT              24</span>
<span class="cp">#define   SYSVIEW_EVTID_NAME_RESOURCE     25</span>
<span class="cp">#define   SYSVIEW_EVTID_PRINT_FORMATTED   26</span>
<span class="cp">#define   SYSVIEW_EVTID_NUMMODULES        27</span>
<span class="cp">#define   SYSVIEW_EVTID_END_CALL          28</span>
<span class="cp">#define   SYSVIEW_EVTID_TASK_TERMINATE    29</span>

<span class="cp">#define   SYSVIEW_EVTID_EX                31</span>
</code></pre></div>
<p>User can define custom IDs starting from 32 in the <code>SEGGER_SYSVIEW_Conf.h</code> header.</p>
</div>
<p>Lets what appear on the System View events: There are recorded events for starting and ending of an API. However, there is just event ID, not a humax-friendly readable API name. In the below image, the TIM3 IRQ handler took 43 us to run, in which the user callback function took 14 us.</p>
<p>
<figure><img src="lab_system_api_no_name.png"/><figcaption>System View with custom API event ID</figcaption>
</figure>
</p>
<div class="np"></div>
<h3 id="38-os-description-file">3.8. OS Description file<a class="headerlink" href="#38-os-description-file" title="Permanent link"></a></h3>
<p>In order for SystemView to properly decode API calls it requires a description file to be present in the <code>/description/</code> directory of SystemView. The name of the file has to be <code>SYSVIEW_&lt;OSName&gt;.txt</code> where <code>&lt;OSName&gt;</code> is the name as sent in the system description.</p>
<p>This lab use <code>Non-OS_Cortex-M0</code> as the OS Name, therefore, it should be a <code>SYSVIEW_Non-OS_Cortex-M0.txt</code> file in the description folder of System View.</p>
<p>
<figure><img src="lab_sysview_description_file.png"/><figcaption>Warning of the OS description file</figcaption>
</figure>
</p>
<div class="admonition info nt">
<p class="admonition-title"></p>
<p>A description file includes all API functions which can be recorded by the OS. Each line in the file is one function in the following format:</p>
<p><mark><code>&lt;ID&gt; &lt;Name&gt; &lt;Parameters&gt; | &lt;ReturnValue&gt;</code></mark></p>
<p><code>&lt;Id&gt;</code> is the Id which is recorded for the API function. It can be in the range of 32 to 511.<br/>
<code>&lt;Name&gt;</code> is the name of the API function, displayed in the Event column of SystemView. It may not contain spaces.<br/>
<code>&lt;Parameters&gt;</code> <code>and &lt;ReturnValue&gt;</code> are the description string of the parameters which are recorded with the API functions. The ReturnValueDescription is optional.</p>
<p>The parameter display can be configured by a set of modifiers:</p>
<ul>
<li><code>%b</code> - Display parameter as binary.</li>
<li><code>%B</code> - Display parameter as hexadecimal string (e.g. 00 AA FF ).</li>
<li><code>%d</code> - Display parameter as signed decimal integer.</li>
<li><code>%D</code> - Display parameter as time value.</li>
<li><code>%I</code> - Display parameter as a resource name if the resource id is known to SystemView.</li>
<li><code>%p</code> - Display parameter as 4 byte hexadecimal integer (e.g. 0xAABBCCDD).</li>
<li><code>%s</code> - Display parameter as string.</li>
<li><code>%t</code> - Display parameter as a task name if the task id is known to SystemView.</li>
<li><code>%u</code> - Display parameter as unsigned decimal integer.</li>
<li><code>%x</code> - Display parameter as hexadecimal integer.</li>
</ul>
<p>The following example shows a part of <code>SYSVIEW_embOS.txt</code>:</p>
<div class="highlight"><pre><span></span><code>46 OS_CreateTask Task=%t Pri=%u Stack=%p Size=%u
</code></pre></div>
<p>In addition to the default modifiers the description file can define <code>NamedTypes</code> to map numerical values to strings, which can for example be useful to display the textual value of enums or error codes. The special character <code>*</code> represents for all remaining unmapped values.</p>
<p><code>NamedTypes</code> have following format:</p>
<p><mark><code>NamedType &lt;TypeName&gt; &lt;Key&gt;=&lt;Value&gt; [&lt;Key1&gt;=&lt;Value1&gt; ...]</code></mark></p>
<p><code>NamedTypes</code> can be used in the <code>&lt;Parameters&gt;</code> and the <code>&lt;ReturnValue&gt;</code>:</p>
<div class="highlight"><pre><span></span><code># Types for parameter formatters
NamedType OSErr 0=OS_ERR_NONE 10000=OS_ERR_A

# API Functions
34 OSFunc Param=%OSFlag | Returns %OSErr
</code></pre></div>
<p>When a task pauses execution its state is recorded in the SystemView event.
This task state can be converted to a textual representation in SystemView with the <code>TaskState</code> description.
<code>TaskState</code> has following format:</p>
<p><mark><code>TaskState &lt;Mask&gt; &lt;Key&gt;=&lt;Value&gt;, [&lt;Key1&gt;=&lt;Value1&gt;, ...]</code></mark></p>
<div class="highlight"><pre><span></span><code># Task States
TaskState 0xFF 0=Ready, 1=Delayed or Timeout
</code></pre></div>
</div>
<div class="admonition caution nt">
<p class="admonition-title"></p>
<p>Always have an empty line in the OS description file to make the last line is parsed properly</p>
</div>
<p>Here is an example of OS Description file used in this lab. There are 2 <code>NamedType</code> defined there, <code>%UARTx</code> and <code>%TIMx</code> which take the mapping address of a peripheral to look up its name using the Data-sheet document.</p>
<div class="file"></div>
<p>SYSVIEW_Non-OS_Cortex-M0.txt</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Types</span>
NamedType UARTx  *<span class="o">=</span>%p <span class="nv">0x40013800</span><span class="o">=</span>UART1 <span class="nv">0x40004400</span><span class="o">=</span>UART2
NamedType TIMx   *<span class="o">=</span>%p <span class="nv">0x40012C00</span><span class="o">=</span>TIM1  <span class="nv">0x40000400</span><span class="o">=</span>TIM3
NamedType PINx   *<span class="o">=</span>%u <span class="nv">0x0</span><span class="o">=</span>None <span class="nv">0x1</span><span class="o">=</span>PIN0 <span class="nv">0x2</span><span class="o">=</span>PIN1

<span class="c1"># API IDs</span>
<span class="m">32</span>    Main_Loop
<span class="m">33</span>    HAL_TIM_PeriodElapsedCallback   <span class="nv">Instance</span> <span class="o">=</span> %TIMx
<span class="m">34</span>    GPIO_EXTI_Callback              <span class="nv">GPIO_Pin</span> <span class="o">=</span> %Pinx
<span class="m">35</span>    HAL_UART_TxCpltCallback         <span class="nv">Instance</span> <span class="o">=</span> %UARTx
</code></pre></div>
<p>Then, the recording function should be changed to transfer API params:</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">HAL_TIM_PeriodElapsedCallback</span><span class="p">(</span><span class="n">TIM_HandleTypeDef</span> <span class="o">*</span><span class="n">htim</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">  <span class="n">SEGGER_SYSVIEW_RecordU32</span><span class="p">(</span><span class="n">APP_EVTID_HAL_TIM_PeriodElapsedCallback</span><span class="p">,</span>
</span><span class="hll">                           <span class="p">(</span><span class="n">U32</span><span class="p">)</span><span class="n">htim</span><span class="o">-&gt;</span><span class="n">Instance</span><span class="p">);</span>
</span>  <span class="k">if</span><span class="p">(</span><span class="n">htim</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">htim3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">HAL_GPIO_TogglePin</span><span class="p">(</span><span class="n">LED_GPIO_Port</span><span class="p">,</span> <span class="n">LED_Pin</span><span class="p">);</span>
  <span class="p">}</span>
<span class="hll">  <span class="n">SEGGER_SYSVIEW_RecordEndCall</span><span class="p">(</span><span class="n">APP_EVTID_HAL_TIM_PeriodElapsedCallback</span><span class="p">);</span>
</span><span class="p">}</span>
</code></pre></div>
<p>The result is much better, with API name and some extra information:</p>
<p>
<figure><img src="lab_sysview_api_name_params.png"/><figcaption>System View with API name and its extra info</figcaption>
</figure>
</p>
<p>Then, use the API description file with string formatter in more complex example:</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">HAL_GPIO_EXTI_Callback</span><span class="p">(</span><span class="kt">uint16_t</span> <span class="n">GPIO_Pin</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SEGGER_SYSVIEW_RecordU32</span><span class="p">(</span><span class="n">APP_EVTID_HAL_GPIO_EXTI_Callback</span><span class="p">,</span> <span class="n">GPIO_Pin</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">GPIO_Pin</span> <span class="o">==</span> <span class="n">GPIO_PIN_0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">counter</span><span class="o">++</span><span class="p">;</span>
    <span class="n">SEGGER_SYSVIEW_WarnfHost</span><span class="p">(</span><span class="s">"counter set to %d"</span><span class="p">,</span> <span class="n">counter</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="n">SEGGER_SYSVIEW_RecordEndCall</span><span class="p">(</span><span class="n">APP_EVTID_HAL_GPIO_EXTI_Callback</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>
<figure><img src="lab_sysview_warning_print.png"/><figcaption>System View with warning message</figcaption>
</figure>
</p>
<div class="np"></div>
<h3 id="39-measure-performance">3.9. Measure performance<a class="headerlink" href="#39-measure-performance" title="Permanent link"></a></h3>
<p>To measure performance, System View uses Markers to calculate the execution time between a starting point and an corresponding ending point.</p>
<p>This lab will send the counter value in two method: blocking, and interrupt. The functions to measure performance is <code>SEGGER_SYSVIEW_MarkStart()</code> and <code>SEGGER_SYSVIEW_MarkStop()</code>, which need IDs to create pairs.</p>
<p>Lets start with defining two marker IDs:</p>
<div class="file"></div>
<p>SEGGER_SYSVIEW_Conf.h</p>
<div class="highlight"><pre><span></span><code><span class="cp">#define APP_MARKER_UART_TX_BLOCKING   0</span>
<span class="cp">#define APP_MARKER_UART_TX_INTERRUPT  1</span>
</code></pre></div>
<p>Then send the marker names in the Device Information callback function:</p>
<div class="highlight"><pre><span></span><code><span class="k">static</span> <span class="kt">void</span> <span class="nf">_cbSendSystemDesc</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">SEGGER_SYSVIEW_SendSysDesc</span><span class="p">(...);</span>
    <span class="n">SEGGER_SYSVIEW_NameMarker</span><span class="p">(</span><span class="n">APP_MARKER_UART_TX_BLOCKING</span><span class="p">,</span>
                              <span class="s">"UART_TX_Blocking"</span><span class="p">);</span>
    <span class="n">SEGGER_SYSVIEW_NameMarker</span><span class="p">(</span><span class="n">APP_MARKER_UART_TX_INTERRUPT</span><span class="p">,</span>
                              <span class="s">"UART_TX_Interrupt"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<p>In the main while loop, firstly, send the counter value using the block method. Wrap the blocking method with a pair of markers.</p>
<p>After the blocking method finish, start the Interrupt method. Note that, in main loop, only mark the starting time. An interrupt will be called when all bytes are transmitted in the <code>HAL_UART_TxCpltCallback()</code> function, therefore, add the ending marker there to calculate the second case.</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span> <span class="nf">HAL_UART_TxCpltCallback</span><span class="p">(</span><span class="n">UART_HandleTypeDef</span> <span class="o">*</span><span class="n">huart</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">SEGGER_SYSVIEW_RecordU32</span><span class="p">(</span><span class="n">APP_EVTID_HAL_UART_TxCpltCallback</span><span class="p">,</span>
                           <span class="p">(</span><span class="n">U32</span><span class="p">)</span><span class="n">huart</span><span class="o">-&gt;</span><span class="n">Instance</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">huart</span> <span class="o">==</span> <span class="o">&amp;</span><span class="n">huart1</span><span class="p">)</span> <span class="p">{</span>
<span class="hll">    <span class="n">SEGGER_SYSVIEW_MarkStop</span><span class="p">(</span><span class="n">APP_MARKER_UART_TX_INTERRUPT</span><span class="p">);</span>
</span>  <span class="p">}</span>
  <span class="n">SEGGER_SYSVIEW_RecordEndCall</span><span class="p">(</span><span class="n">APP_EVTID_HAL_UART_TxCpltCallback</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">SEGGER_SYSVIEW_RecordVoid</span><span class="p">(</span><span class="n">APP_EVTID_MAIN_LOOP</span><span class="p">);</span>
    <span class="n">sprintf</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="s">"counter = %03d</span><span class="se">\r\n</span><span class="s">"</span><span class="p">,</span> <span class="n">counter</span><span class="p">);</span>
    <span class="c1">// measure UART TX blocking mode</span>
<span class="hll">    <span class="n">SEGGER_SYSVIEW_MarkStart</span><span class="p">(</span><span class="n">APP_MARKER_UART_TX_BLOCKING</span><span class="p">);</span>
</span>    <span class="n">HAL_UART_Transmit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">huart1</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">buffer</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buffer</span><span class="p">),</span>
                                <span class="n">HAL_MAX_DELAY</span><span class="p">);</span>
<span class="hll">    <span class="n">SEGGER_SYSVIEW_MarkStop</span><span class="p">(</span><span class="n">APP_MARKER_UART_TX_BLOCKING</span><span class="p">);</span>
</span>    <span class="c1">// measure UART TX interrupt mode</span>
<span class="hll">    <span class="n">SEGGER_SYSVIEW_MarkStart</span><span class="p">(</span><span class="n">APP_MARKER_UART_TX_INTERRUPT</span><span class="p">);</span>
</span>    <span class="n">HAL_UART_Transmit_IT</span><span class="p">(</span><span class="o">&amp;</span><span class="n">huart1</span><span class="p">,</span> <span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="n">buffer</span><span class="p">,</span> <span class="n">strlen</span><span class="p">(</span><span class="n">buffer</span><span class="p">));</span>
    <span class="c1">// print</span>
    <span class="n">SEGGER_SYSVIEW_Print</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
    <span class="c1">// delay</span>
    <span class="n">HAL_Delay</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
    <span class="n">SEGGER_SYSVIEW_RecordEndCall</span><span class="p">(</span><span class="n">APP_EVTID_MAIN_LOOP</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>The result of measuring two performance points is as below:</p>
<p>
<figure><img src="lab_performance_view.png"/><figcaption>The performance makers show the execution time</figcaption>
</figure>
</p>
<p>Look at the above image, firstly, it tells that both 2 methods need the same time to complete transmitting the same message.</p>
<p>However, note that, in the Blocking mode, CPU is busy of wasting, while in the Interrupt mode, CPU can do something else when there is no interrupt. The total execution time of all interrupts is about  of the time needed by the blocking mode.</p>
<div class="np"></div>
<h2 id="4-appendix">4. Appendix<a class="headerlink" href="#4-appendix" title="Permanent link"></a></h2>
<p><strong>How to get Interrupt ID?</strong></p>
<div class="highlight"><pre><span></span><code><span class="cm">/*********************************************************************</span>
<span class="cm">*</span>
<span class="cm">*  Define: SEGGER_SYSVIEW_GET_INTERRUPT_ID()</span>
<span class="cm">*</span>
<span class="cm">*  Description</span>
<span class="cm">*    Function macro to retrieve the Id of the currently active</span>
<span class="cm">*    interrupt.</span>
<span class="cm">*  Default</span>
<span class="cm">*    Call user-supplied function SEGGER_SYSVIEW_X_GetInterruptId().</span>
<span class="cm">*  Notes</span>
<span class="cm">*    For some known compilers and cores, a ready-to-use, core-specific</span>
<span class="cm">*    default is set.</span>
<span class="cm">*    ARMv7M: Read ICSR[8:0] (active vector)</span>
<span class="cm">*    ARMv6M: Read ICSR[5:0] (active vector)</span>
<span class="cm">*/</span>
<span class="cp">#ifndef SEGGER_SYSVIEW_GET_INTERRUPT_ID</span>
  <span class="cp">#if SEGGER_SYSVIEW_CORE == SEGGER_SYSVIEW_CORE_CM3</span>
  <span class="c1">// Get the currently active interrupt Id.</span>
  <span class="c1">// (i.e. read Cortex-M ICSR[8:0] = active vector)</span>
    <span class="cp">#define SEGGER_SYSVIEW_GET_INTERRUPT_ID()     ((*(U32*)(0xE000ED04)) &amp; 0x1FF)</span>
  <span class="cp">#elif SEGGER_SYSVIEW_CORE == SEGGER_SYSVIEW_CORE_CM0</span>
    <span class="cp">#if defined(__ICCARM__)</span>
      <span class="cp">#if (__VER__ &gt; 6010000)</span>
        <span class="c1">// Workaround for IAR, which might do a byte-access to 0xE000ED04.</span>
        <span class="c1">// Read IPSR instead.</span>
        <span class="cp">#define SEGGER_SYSVIEW_GET_INTERRUPT_ID() (__get_IPSR())</span>
      <span class="cp">#else</span>
        <span class="c1">// Older versions of IAR do not include __get_IPSR,</span>
        <span class="c1">// but might also not optimize to byte-access.</span>
        <span class="cp">#define SEGGER_SYSVIEW_GET_INTERRUPT_ID() ((*(U32*)(0xE000ED04)) &amp; 0x3F)</span>
      <span class="cp">#endif</span>
    <span class="cp">#else</span>
      <span class="c1">// Get the currently active interrupt Id.</span>
      <span class="c1">// (i.e. read Cortex-M ICSR[5:0] = active vector)</span>
      <span class="cp">#define SEGGER_SYSVIEW_GET_INTERRUPT_ID()   ((*(U32*)(0xE000ED04)) &amp; 0x3F)</span>
    <span class="cp">#endif</span>
  <span class="cp">#else</span>
    <span class="c1">// Get the currently active interrupt Id from the user-provided function.</span>
    <span class="cp">#define SEGGER_SYSVIEW_GET_INTERRUPT_ID()     SEGGER_SYSVIEW_X_GetInterruptId()</span>
  <span class="cp">#endif</span>
<span class="cp">#endif</span>
</code></pre></div>
<div class="np"></div>
<div class="highlight"><pre><span></span><code><span class="cm">/*********************************************************************</span>
<span class="cm">*</span>
<span class="cm">*       SEGGER_SYSVIEW_X_GetInterruptId()</span>
<span class="cm">*</span>
<span class="cm">* Function description</span>
<span class="cm">*   Return the currently active interrupt Id,</span>
<span class="cm">*   which ist the active vector taken from IPSR[5:0].</span>
<span class="cm">*</span>
<span class="cm">* Return value</span>
<span class="cm">*   The current currently active interrupt Id.</span>
<span class="cm">*</span>
<span class="cm">* Additional information</span>
<span class="cm">*   This function is not used by default, as the active vector can be</span>
<span class="cm">*   read from ICSR instead on Cortex-M0.</span>
<span class="cm">*   For Cortex-M0+ devices, change SEGGER_SYSVIEW_GET_INTERRUPT_ID</span>
<span class="cm">*   in SEGGER_SYSVIEW_Conf.h to call this function instead.</span>
<span class="cm">*/</span>
<span class="n">U32</span> <span class="nf">SEGGER_SYSVIEW_X_GetInterruptId</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">U32</span> <span class="n">Id</span><span class="p">;</span>

  <span class="kr">__asm</span> <span class="k">volatile</span> <span class="p">(</span><span class="s">"mrs %0, ipsr"</span>
                  <span class="o">:</span> <span class="s">"=r"</span> <span class="p">(</span><span class="n">Id</span><span class="p">)</span>
                  <span class="p">);</span>
  <span class="n">Id</span> <span class="o">&amp;=</span> <span class="mh">0x3F</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">Id</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<div class="np"></div>
<p><strong>How to get Timestamp?</strong></p>
<div class="highlight"><pre><span></span><code><span class="cm">/*********************************************************************</span>
<span class="cm">*</span>
<span class="cm">*       Define: SEGGER_SYSVIEW_GET_TIMESTAMP()</span>
<span class="cm">*</span>
<span class="cm">*  Description</span>
<span class="cm">*    Function macro to retrieve a system timestamp for SYSVIEW events.</span>
<span class="cm">*  Default</span>
<span class="cm">*    Call user-supplied function SEGGER_SYSVIEW_X_GetTimestamp().</span>
<span class="cm">*  Notes</span>
<span class="cm">*    For some known compilers and cores, a ready-to-use, core-specific</span>
<span class="cm">*    default is set.</span>
<span class="cm">*    ARMv7M: Read Cortex-M Cycle Count register.</span>
<span class="cm">*</span>
<span class="cm">*    The system timestamp clock frequency has to be passed in</span>
<span class="cm">*    SEGGER_SYSVIEW_Init().</span>
<span class="cm">*/</span>
<span class="cp">#ifndef SEGGER_SYSVIEW_GET_TIMESTAMP</span>
  <span class="cp">#if defined (SEGGER_SYSVIEW_CORE) &amp;&amp; (SEGGER_SYSVIEW_CORE == SEGGER_SYSVIEW_CORE_CM3)</span>
    <span class="c1">// Retrieve a system timestamp. Cortex-M cycle counter.</span>
    <span class="cp">#define SEGGER_SYSVIEW_GET_TIMESTAMP()    (*(U32 *)(0xE0001004))</span>
  <span class="cp">#else</span>
    <span class="c1">// Retrieve a system timestamp via user-defined function</span>
    <span class="cp">#define SEGGER_SYSVIEW_GET_TIMESTAMP()    SEGGER_SYSVIEW_X_GetTimestamp()</span>
  <span class="cp">#endif</span>
<span class="cp">#endif</span>
</code></pre></div>
<div class="np"></div>
<div class="highlight"><pre><span></span><code><span class="cm">/*********************************************************************</span>
<span class="cm">*</span>
<span class="cm">* SEGGER_SYSVIEW_X_GetTimestamp()</span>
<span class="cm">*</span>
<span class="cm">* Function description</span>
<span class="cm">*   Returns the current timestamp in ticks using the system tick</span>
<span class="cm">*   count and the SysTick counter.</span>
<span class="cm">*   All parameters of the SysTick have to be known and are set via</span>
<span class="cm">*   configuration defines on top of the file.</span>
<span class="cm">*</span>
<span class="cm">* Return value</span>
<span class="cm">*   The current timestamp.</span>
<span class="cm">*</span>
<span class="cm">* Additional information</span>
<span class="cm">*   SEGGER_SYSVIEW_X_GetTimestamp is always called when interrupts are</span>
<span class="cm">*   disabled. Therefore locking here is not required.</span>
<span class="cm">*/</span>
<span class="n">U32</span> <span class="nf">SEGGER_SYSVIEW_X_GetTimestamp</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#if USE_CYCCNT_TIMESTAMP</span>
  <span class="n">U32</span> <span class="n">TickCount</span><span class="p">;</span>
  <span class="n">U32</span> <span class="n">Cycles</span><span class="p">;</span>
  <span class="n">U32</span> <span class="n">CyclesPerTick</span><span class="p">;</span>
  <span class="c1">//</span>
  <span class="c1">// Get the cycles of the current system tick.</span>
  <span class="c1">// SysTick is down-counting, subtract the current value</span>
  <span class="c1">// from the number of cycles per tick.</span>
  <span class="c1">//</span>
  <span class="n">CyclesPerTick</span> <span class="o">=</span> <span class="n">SYST_RVR</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">Cycles</span> <span class="o">=</span> <span class="p">(</span><span class="n">CyclesPerTick</span> <span class="o">-</span> <span class="n">SYST_CVR</span><span class="p">);</span>
  <span class="c1">//</span>
  <span class="c1">// Get the system tick count.</span>
  <span class="c1">//</span>
  <span class="n">TickCount</span> <span class="o">=</span> <span class="n">SEGGER_SYSVIEW_TickCnt</span><span class="p">;</span>
  <span class="c1">//</span>
  <span class="c1">// If a SysTick interrupt is pending, re-read timer and adjust result</span>
  <span class="c1">//</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">SCB_ICSR</span> <span class="o">&amp;</span> <span class="n">SCB_ICSR_PENDSTSET_MASK</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Cycles</span> <span class="o">=</span> <span class="p">(</span><span class="n">CyclesPerTick</span> <span class="o">-</span> <span class="n">SYST_CVR</span><span class="p">);</span>
    <span class="n">TickCount</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Cycles</span> <span class="o">+=</span> <span class="n">TickCount</span> <span class="o">*</span> <span class="n">CyclesPerTick</span><span class="p">;</span>

  <span class="k">return</span> <span class="n">Cycles</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">}</span>
</code></pre></div>
<div class="np"></div>
<p>Do you see how cycles is calculated?</p>
<div class="highlight"><pre><span></span><code><span class="n">Cycles</span> <span class="o">+=</span> <span class="n">TickCount</span> <span class="o">*</span> <span class="n">CyclesPerTick</span><span class="p">;</span>
</code></pre></div>
<p>Have you thought it is not optimized?
Use breakpoints before and after that line, and compare the value of the SysTick Current Value Register to see how many cycles are used.</p>
<div class="highlight"><pre><span></span><code><span class="cp">#define SYST_CVR  (*(volatile U32*) (0xE000E018uL))</span>
</code></pre></div>
<p><mark>Its just about 12 cycles.</mark></p>
<p>If you want to save 12 cycles in slow MCUs, here is an optimized version:</p>
<div class="highlight"><pre><span></span><code><span class="n">U32</span> <span class="n">CyclesPerTick</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">U32</span> <span class="n">TotalCycles</span> <span class="o">=</span> <span class="mi">0</span>

<span class="kt">void</span> <span class="n">SEGGER_SYSVIEW_Conf</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="n">CyclesPerTick</span> <span class="o">=</span> <span class="n">SYST_RVR</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">U32</span> <span class="n">SEGGER_SYSVIEW_X_GetTimestamp</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
<span class="cp">#if USE_CYCCNT_TIMESTAMP</span>
  <span class="n">U32</span> <span class="n">Cycles</span><span class="p">;</span>
  <span class="c1">//</span>
  <span class="c1">// Get the cycles of the current system tick.</span>
  <span class="c1">// SysTick is down-counting, subtract the current value from the number of cycles per tick.</span>
  <span class="c1">//</span>
  <span class="n">Cycles</span> <span class="o">=</span> <span class="p">(</span><span class="n">CyclesPerTick</span> <span class="o">-</span> <span class="n">SYST_CVR</span><span class="p">);</span>
  <span class="c1">//</span>
  <span class="c1">// If a SysTick interrupt is pending, re-read timer and adjust result</span>
  <span class="c1">//</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">SCB_ICSR</span> <span class="o">&amp;</span> <span class="n">SCB_ICSR_PENDSTSET_MASK</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Cycles</span> <span class="o">=</span> <span class="p">(</span><span class="n">CyclesPerTick</span> <span class="o">-</span> <span class="n">SYST_CVR</span><span class="p">);</span>
    <span class="c1">// calculate the total cycles in advance,</span>
    <span class="c1">// but the actual total cycles will be updated when SysTick is handled</span>
    <span class="k">return</span> <span class="n">TotalCycles</span> <span class="o">+</span> <span class="n">CyclesPerTick</span> <span class="o">+</span> <span class="n">Cycles</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="n">TotalCycles</span> <span class="o">+</span> <span class="n">Cycles</span><span class="p">;</span>
<span class="cp">#endif</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">SysTick_Handler</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">TotalCycles</span> <span class="o">+=</span> <span class="n">CyclesPerTick</span><span class="p">;</span>
  <span class="n">HAL_IncTick</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>
<div data-value="https://www.codeinsideout.com/blog/stm32/j-link-sysview/" id="page_url"></div>
<div data-value="blog/stm32/j-link-sysview/" id="page_identifier"></div>
<div>
<h2 id="__comments">Comments</h2>
<div id="disqus_thread"></div>
<script>var disqus_config = function () { this.page.url = "https://www.codeinsideout.com/blog/stm32/j-link-sysview/", this.page.identifier = "blog/stm32/j-link-sysview/" }; window.addEventListener("load", function () { var e = document, i = e.createElement("script"); i.src = "//vuquangtrong-github-io.disqus.com/embed.js", i.setAttribute("data-timestamp", +new Date), (e.head || e.body).appendChild(i) })</script>
</div>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" data-md-state="hidden" href="#" title="Back to top">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path></svg>
</a>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: J-Link RTT" class="md-footer__link md-footer__link--prev" href="../j-link-rtt/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              J-Link RTT
            </div>
</div>
</a>
<a aria-label="Next: Notes" class="md-footer__link md-footer__link--next" href="../notes/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              Notes
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
             2021 Code Inside Out <div style="display:none"><div>
</div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
<div>
    using
    <a href="https://github.com/vuquangtrong/mkdocs-material-blog">
        MkDocs Material Blog
    </a>
    theme
</div>
</div>
</div>
<div class="md-footer-social">
<a class="md-footer-social__link" href="https://github.com/vuquangtrong" rel="noopener" target="_blank" title="vuquangtrong">
<svg viewbox="0 0 480 512" xmlns="http://www.w3.org/2000/svg"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://facebook.com/trongvq" rel="noopener" target="_blank" title="trongvq">
<svg viewbox="0 0 320 512" xmlns="http://www.w3.org/2000/svg"><path d="m279.14 288 14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://www.linkedin.com/in/vqtrong" rel="noopener" target="_blank" title="vqtrong">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.instant", "navigation.tabs", "navigation.top", "header.autohide"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../assets/javascripts/workers/search.477d984a.min.js", "version": null}</script>
<script src="../../../assets/javascripts/bundle.82b56eb2.min.js"></script>
<script src="../../../assets/view-bigimg.js"></script>
<script src="../../../assets/extra.js"></script>
</body>
</html>