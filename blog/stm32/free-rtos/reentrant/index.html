
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<meta content="Reentrancy is an attribute of a piece of code and basically means it can be re-entered by another execution flow, for example by an interrupt or by another task or thread. GNU ARM Embedded Toolchain distributions include a non-polluting reduced-size runtime library called Newlib. FreeRTOS has not fully supported reentrant for Newlib." name="description"/>
<meta content="embedded systems application programming" name="keywords"/>
<meta content="vqtrong" name="author"/>
<link href="https://www.codeinsideout.com/blog/stm32/free-rtos/reentrant/" rel="canonical"/>
<link href="../../../../favicon.png" rel="icon"/>
<meta content="mkdocs-1.2.2, mkdocs-material-7.2.4" name="generator"/>
<title>FreeRTOS - Newlib Reentrant - Code Inside Out</title>
<link href="../../../../assets/stylesheets/main.f7f47774.min.css" rel="stylesheet"/>
<link href="../../../../assets/stylesheets/palette.3f5d1f46.min.css" rel="stylesheet"/>
<meta content="#ffffff" name="theme-color"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Noto+Serif:300,400,400i,700%7CRoboto+Mono&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font-family:"Noto Serif";--md-code-font-family:"Roboto Mono"}</style>
<link href="../../../../assets/view-bigimg.css" rel="stylesheet"/>
<link href="../../../../assets/extra.css" rel="stylesheet"/>
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-42618265-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<meta content="website" property="og:type">
<meta content="FreeRTOS - Newlib Reentrant - Code Inside Out" property="og:title">
<meta content="Reentrancy is an attribute of a piece of code and basically means it can be re-entered by another execution flow, for example by an interrupt or by another task or thread. GNU ARM Embedded Toolchain distributions include a non-polluting reduced-size runtime library called Newlib. FreeRTOS has not fully supported reentrant for Newlib." property="og:description">
<meta content="https://www.codeinsideout.com/blog/stm32/free-rtos/reentrant/" property="og:url">
<meta content="https://www.codeinsideout.com/assets/banner.jpg" property="og:image">
<meta content="Code Inside Out" property="og:site_name">
<meta content="summary" name="twitter:card">
</meta></meta></meta></meta></meta></meta></meta></head>
<body data-md-color-accent="deep-orange" data-md-color-primary="white" data-md-color-scheme="" dir="ltr">
<script>function __prefix(e){return new URL("../../../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#1-reentrant">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="Code Inside Out" class="md-header__button md-logo" data-md-component="logo" href="../../../.." title="Code Inside Out">
<svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            Code Inside Out
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              Reentrant
            
          </span>
</div>
</div>
</div>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"></path></svg>
</button>
</nav>
<div class="md-search__suggest" data-md-component="search-suggest"></div>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<nav aria-label="Tabs" class="md-tabs" data-md-component="tabs">
<div class="md-tabs__inner md-grid">
<ul class="md-tabs__list">
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../..">
      Home
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link md-tabs__link--active" href="../../../">
      Blog
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../projects/">
      Projects
    </a>
</li>
<li class="md-tabs__item">
<a class="md-tabs__link" href="../../../../tags/">
      Tags
    </a>
</li>
</ul>
</div>
</nav>
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<style>
        .md-sidebar {
            opacity: 0.2;
        }
        .md-sidebar:hover {
            opacity: 1;
        }
    </style>
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary md-nav--lifted" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="Code Inside Out" class="md-nav__button md-logo" data-md-component="logo" href="../../../.." title="Code Inside Out">
<svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"></path></svg>
</a>
    Code Inside Out
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../..">
        Home
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../" style="margin: initial; padding: initial; pointer-events: initial">
        
          Blog
        </a>
</label>
<nav aria-label="Blog" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../" style="margin: initial; padding: initial; pointer-events: initial">
          
            Blog
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1" id="__nav_2_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../" style="margin: initial; padding: initial; pointer-events: initial">
        
          STM32
        </a>
</label>
<nav aria-label="STM32" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_1">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../" style="margin: initial; padding: initial; pointer-events: initial">
          
            STM32
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../intro/">
        Introduction
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../prepare/">
        Preparation
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../tools/">
        Toolchain
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../docs/">
        Documents
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../clock/">
        Clock Tree
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../interrupt/">
        Interrupt
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../semihosting/">
        SemiHosting
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../gpio/">
        GPIO
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../dma/">
        DMA
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../swv/">
        SWV
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../add-swo/">
        Add SWO
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../uart/">
        UART
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../uart-redirection/">
        UART Redirection
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../timer/">
        Timers
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../sensor-us-100/">
        US-100 Sensor
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../adc/">
        ADC
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../i2c-spi/">
        I2C - SPI
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../oled-ssd1306/">
        SSD1306 OLED
      </a>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_1_19" id="__nav_2_1_19" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_1_19">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../overview/" style="margin: initial; padding: initial; pointer-events: initial">
        
          FreeRTOS
        </a>
</label>
<nav aria-label="FreeRTOS" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_1_19">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../overview/" style="margin: initial; padding: initial; pointer-events: initial">
          
            FreeRTOS
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../systick/">
        SysTick &amp; Delay
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../memory/">
        Memory
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../interrupt/">
        Interrupt
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../tasks/">
        Tasks
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" data-md-toggle="toc" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link md-nav__link--active" href="./" style="margin: initial; padding: initial; pointer-events: initial">
          
            Reentrant
          </a>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        Reentrant
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-reentrant">
    1. Reentrant
  </a>
<nav aria-label="1. Reentrant" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11-rules-for-reentrant">
    1.1. Rules for reentrant
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12-examples">
    1.2. Examples
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-newlib-implementation">
    2. Newlib implementation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-newlib-reentrant">
    3. Newlib reentrant
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-freertos-supports-newlib-reentrant">
    4. FreeRTOS supports Newlib reentrant
  </a>
<nav aria-label="4. FreeRTOS supports Newlib reentrant" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#41-switching-context">
    4.1. Switching context
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#42-concurrency-protection">
    4.2. Concurrency protection
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-lab-0-reentrant-printf-function">
    5. Lab 0: Reentrant printf function
  </a>
<nav aria-label="5. Lab 0: Reentrant printf function" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#51-precondition">
    5.1. Precondition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#52-create-2-printing-tasks">
    5.2. Create 2 printing tasks
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#53-define-messages-and-print-out">
    5.3. Define messages and print out
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#54-compile-and-run">
    5.4. Compile and Run
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#55-turn-on-newlib-reentrant">
    5.5. Turn on Newlib reentrant
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#56-debug-and-analyze">
    5.6. Debug and Analyze
  </a>
<nav aria-label="5.6. Debug and Analyze" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#561-non-reentrant">
    5.6.1. Non-reentrant
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#562-reentrant">
    5.6.2. Reentrant
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-integrate-newlib-memory-scheme">
    6. Integrate Newlib memory scheme
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-references">
    7. References
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../stack/">
        Stack Overflow
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../j-link-rtt/">
        J-Link RTT
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../j-link-sysview/">
        J-Link SysView
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../notes/">
        Notes
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_2" id="__nav_2_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../pi/" style="margin: initial; padding: initial; pointer-events: initial">
        
          Raspberry Pi
        </a>
</label>
<nav aria-label="Raspberry Pi" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_2">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../pi/" style="margin: initial; padding: initial; pointer-events: initial">
          
            Raspberry Pi
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../pi/headless-mode/">
        Headless mode
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../pi/compile-ffmpeg/">
        Compile FFmpeg
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../pi/resource-usage/">
        Resource usage
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../pi/setup-camera/">
        Setup Camera
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../pi/stream-ffmpeg-hls-dash/">
        HLS/DASH Streaming
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../pi/stream-picamera-mjpeg/">
        MJPEG streaming
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../pi/stream-picamera-h264/">
        H264 streaming
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../pi/backup-sdcard/">
        Backup SDCard
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../pi/check-camera-i2c/">
        Diagnostic Camera
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../pi/ubuntu/">
        Ubuntu
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../pi/notes/">
        Notes
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_3" id="__nav_2_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../c-cpp/" style="margin: initial; padding: initial; pointer-events: initial">
        
          C/C++
        </a>
</label>
<nav aria-label="C/C++" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_3">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../c-cpp/" style="margin: initial; padding: initial; pointer-events: initial">
          
            C/C++
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../c-cpp/notes/">
        Notes
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4" id="__nav_2_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../gnss/" style="margin: initial; padding: initial; pointer-events: initial">
        
          GNSS
        </a>
</label>
<nav aria-label="GNSS" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_4">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../gnss/" style="margin: initial; padding: initial; pointer-events: initial">
          
            GNSS
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_4_1" id="__nav_2_4_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_4_1">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../gnss/unicorecomm/" style="margin: initial; padding: initial; pointer-events: initial">
        
          Unicorecomm
        </a>
</label>
<nav aria-label="Unicorecomm" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_4_1">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../gnss/unicorecomm/" style="margin: initial; padding: initial; pointer-events: initial">
          
            Unicorecomm
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../gnss/unicorecomm/ub4xx/">
        UB482/UB4B0M
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5" id="__nav_2_5" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../imu/" style="margin: initial; padding: initial; pointer-events: initial">
        
          IMU
        </a>
</label>
<nav aria-label="IMU" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_5">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../imu/" style="margin: initial; padding: initial; pointer-events: initial">
          
            IMU
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_5_1" id="__nav_2_5_1" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_5_1">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../imu/invensense/" style="margin: initial; padding: initial; pointer-events: initial">
        
          InvenSense
        </a>
</label>
<nav aria-label="InvenSense" class="md-nav" data-md-level="3">
<label class="md-nav__title" for="__nav_2_5_1">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../imu/invensense/" style="margin: initial; padding: initial; pointer-events: initial">
          
            InvenSense
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../imu/invensense/dk-20789/">
        DK-20789
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_6" id="__nav_2_6" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_6">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../lidar/" style="margin: initial; padding: initial; pointer-events: initial">
        
          LIDAR
        </a>
</label>
<nav aria-label="LIDAR" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_6">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../lidar/" style="margin: initial; padding: initial; pointer-events: initial">
          
            LIDAR
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../lidar/livox-sdk/">
        Livox SDK
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../lidar/livox-mapping-apx15/">
        Livox high precision mapping
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_7" id="__nav_2_7" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_7">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../linux/" style="margin: initial; padding: initial; pointer-events: initial">
        
          Linux
        </a>
</label>
<nav aria-label="Linux" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_7">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../linux/" style="margin: initial; padding: initial; pointer-events: initial">
          
            Linux
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../linux/byobu/">
        Byobu
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../linux/dual-boot/">
        Dual Boot
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../linux/samba/">
        Samba
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../linux/tweaks/">
        Tweaks
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_8" id="__nav_2_8" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_8">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../ros/" style="margin: initial; padding: initial; pointer-events: initial">
        
          ROS
        </a>
</label>
<nav aria-label="ROS" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_8">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../ros/" style="margin: initial; padding: initial; pointer-events: initial">
          
            ROS
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../ros/tutorial-beginner/">
        Tutorial for Beginners
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_9" id="__nav_2_9" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_9">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../setup-blog/" style="margin: initial; padding: initial; pointer-events: initial">
        
          Setup blog
        </a>
</label>
<nav aria-label="Setup blog" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_9">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../setup-blog/" style="margin: initial; padding: initial; pointer-events: initial">
          
            Setup blog
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../setup-blog/markdown-syntax/">
        Markdown syntax
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../setup-blog/mkdocs-plugins/">
        MkDocs plugins
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../setup-blog/customize-theme/">
        Customize theme
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../setup-blog/print-to-pdf/">
        Print to PDF
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../setup-blog/fix-ajax-issue/">
        Fix AJAX issue
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2_10" id="__nav_2_10" type="checkbox"/>
<label class="md-nav__link" for="__nav_2_10">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../virtual-machine/" style="margin: initial; padding: initial; pointer-events: initial">
        
          Virtual machine
        </a>
</label>
<nav aria-label="Virtual machine" class="md-nav" data-md-level="2">
<label class="md-nav__title" for="__nav_2_10">
<span class="md-nav__icon md-icon"></span>
<a class="md-nav__link" href="../../../virtual-machine/" style="margin: initial; padding: initial; pointer-events: initial">
          
            Virtual machine
          </a>
</label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../../virtual-machine/docker/">
        Docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../virtual-machine/hyper-v/">
        Hyper-V
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../projects/">
        Projects
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../../../tags/">
        Tags
      </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-reentrant">
    1. Reentrant
  </a>
<nav aria-label="1. Reentrant" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11-rules-for-reentrant">
    1.1. Rules for reentrant
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12-examples">
    1.2. Examples
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-newlib-implementation">
    2. Newlib implementation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-newlib-reentrant">
    3. Newlib reentrant
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-freertos-supports-newlib-reentrant">
    4. FreeRTOS supports Newlib reentrant
  </a>
<nav aria-label="4. FreeRTOS supports Newlib reentrant" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#41-switching-context">
    4.1. Switching context
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#42-concurrency-protection">
    4.2. Concurrency protection
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-lab-0-reentrant-printf-function">
    5. Lab 0: Reentrant printf function
  </a>
<nav aria-label="5. Lab 0: Reentrant printf function" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#51-precondition">
    5.1. Precondition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#52-create-2-printing-tasks">
    5.2. Create 2 printing tasks
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#53-define-messages-and-print-out">
    5.3. Define messages and print out
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#54-compile-and-run">
    5.4. Compile and Run
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#55-turn-on-newlib-reentrant">
    5.5. Turn on Newlib reentrant
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#56-debug-and-analyze">
    5.6. Debug and Analyze
  </a>
<nav aria-label="5.6. Debug and Analyze" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#561-non-reentrant">
    5.6.1. Non-reentrant
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#562-reentrant">
    5.6.2. Reentrant
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-integrate-newlib-memory-scheme">
    6. Integrate Newlib memory scheme
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-references">
    7. References
  </a>
</li>
</ul>
</nav>
<div class="tag-cloud-toc">
<p class="md-nav" style="margin-bottom: 0.5em;">
<label class="md-nav__title">Tag cloud</label>
</p>
<div class="tag-cloud-content">
<a class="tag" href="https://www.codeinsideout.com/tags/#usart">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkTurquoise;
        ">usart</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#linux">
<span class="tag-name" style="
          font-size:0.75rem;
          color:DarkOliveGreen;
        ">linux</span>
<!--<sup class="tag-count">5</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#material">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkMagenta;
        ">material</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#camera">
<span class="tag-name" style="
          font-size:0.8rem;
          color:DarkOliveGreen;
        ">camera</span>
<!--<sup class="tag-count">6</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#virtual-machine">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkGoldenrod;
        ">virtual-machine</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#hyper-v">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkMagenta;
        ">hyper-v</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#clock">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkOliveGreen;
        ">clock</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#ins">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkTurquoise;
        ">ins</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#gpio">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateBlue;
        ">gpio</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#gps">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkTurquoise;
        ">gps</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#dash">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">dash</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#redirect">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">redirect</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#capture">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGoldenrod;
        ">capture</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#mkdocs">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkMagenta;
        ">mkdocs</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#performance">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkTurquoise;
        ">performance</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#imu">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGoldenrod;
        ">imu</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#arm">
<span class="tag-name" style="
          font-size:1.6500000000000001rem;
          color:DarkTurquoise;
        ">arm</span>
<!--<sup class="tag-count">23</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#ajax">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">ajax</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#debug">
<span class="tag-name" style="
          font-size:0.75rem;
          color:DarkMagenta;
        ">debug</span>
<!--<sup class="tag-count">5</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#sysview">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">sysview</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#toolchain">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOrchid;
        ">toolchain</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pwm">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOrchid;
        ">pwm</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#rtt">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkBlue;
        ">rtt</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#gnss">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkBlue;
        ">gnss</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#docker">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGreen;
        ">docker</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#sharing">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGoldenrod;
        ">sharing</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#v4l2">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkCyan;
        ">v4l2</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#markdown">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkMagenta;
        ">markdown</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#ffmpeg">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkCyan;
        ">ffmpeg</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#notes">
<span class="tag-name" style="
          font-size:0.7rem;
          color:DarkOrchid;
        ">notes</span>
<!--<sup class="tag-count">4</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#javascript">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkCyan;
        ">javascript</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#memory">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkOliveGreen;
        ">memory</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#python">
<span class="tag-name" style="
          font-size:0.75rem;
          color:DarkBlue;
        ">python</span>
<!--<sup class="tag-count">5</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#html">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkCyan;
        ">html</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#mapping">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkTurquoise;
        ">mapping</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#headless">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">headless</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#spi">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">spi</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#libs">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkBlue;
        ">libs</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#oled">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOrchid;
        ">oled</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#raspberry-pi">
<span class="tag-name" style="
          font-size:1.05rem;
          color:DarkSlateBlue;
        ">raspberry-pi</span>
<!--<sup class="tag-count">11</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#jinja">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOrchid;
        ">jinja</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#css">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateBlue;
        ">css</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#container">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">container</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#interrupt">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkTurquoise;
        ">interrupt</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#sdcard">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGoldenrod;
        ">sdcard</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#virtual">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateBlue;
        ">virtual</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#lidar">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkSlateGray;
        ">lidar</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#timer">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">timer</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#sensor">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkRed;
        ">sensor</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#stack">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateGray;
        ">stack</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#i2c">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkViolet;
        ">i2c</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#uart">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkTurquoise;
        ">uart</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#hls">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkSlateGray;
        ">hls</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#adc">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGreen;
        ">adc</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#pdf">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGreen;
        ">pdf</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#stm32">
<span class="tag-name" style="
          font-size:1.8rem;
          color:DarkBlue;
        ">stm32</span>
<!--<sup class="tag-count">26</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#picamera">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkOrchid;
        ">picamera</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#reentrant">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGoldenrod;
        ">reentrant</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#docs">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkGreen;
        ">docs</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#swv">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">swv</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#c/c++">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOrchid;
        ">c/c++</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#mjpeg">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkOliveGreen;
        ">mjpeg</span>
<!--<sup class="tag-count">1</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#ros">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkOliveGreen;
        ">ros</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#dma">
<span class="tag-name" style="
          font-size:0.6rem;
          color:DarkViolet;
        ">dma</span>
<!--<sup class="tag-count">2</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#stream">
<span class="tag-name" style="
          font-size:0.65rem;
          color:DarkOliveGreen;
        ">stream</span>
<!--<sup class="tag-count">3</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#rtos">
<span class="tag-name" style="
          font-size:0.75rem;
          color:DarkGreen;
        ">rtos</span>
<!--<sup class="tag-count">5</sup>-->
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#h264">
<span class="tag-name" style="
          font-size:0.55rem;
          color:DarkViolet;
        ">h264</span>
<!--<sup class="tag-count">1</sup>-->
</a>
</div>
</div>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<style>
            .md-typeset .cover {
                margin-bottom: 1em;
            }
            @media print {
                .md-typeset .cover {
                    height: 100vh;
                    display: flex;
                    flex-direction: column;
                    justify-content: center;
                }
            }
        </style>
<div class="cover">
<h1 class="page-title">FreeRTOS - Newlib Reentrant</h1>
<p class="page-description">Reentrancy is an attribute of a piece of code and basically means it can be re-entered by another execution flow, for example by an interrupt or by another task or thread. GNU ARM Embedded Toolchain distributions include a non-polluting reduced-size runtime library called Newlib. FreeRTOS has not fully supported reentrant for Newlib.</p>
<p class="page-tags">
<a class="tag" href="https://www.codeinsideout.com/tags/#arm">
<span class="tag-name">
                        #arm
                    </span>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#stm32">
<span class="tag-name">
                        #stm32
                    </span>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#libs">
<span class="tag-name">
                        #libs
                    </span>
</a>
<a class="tag" href="https://www.codeinsideout.com/tags/#reentrant">
<span class="tag-name">
                        #reentrant
                    </span>
</a>
</p>
<p class="md-source-date">
<hr style="margin-bottom: .5em;"/>
<small>
                            Last update:
                            <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-iso_datetime">2021-08-17 10:23:58</span>
</small>
</p>
</div>
<style>
            .md-typeset .toc {
                display: none;
            }
            .md-typeset .toc label {
                display: none;
            }
            .md-typeset .toc .md-nav {
                font-size: unset;
                line-height: 1.6;
            }
            .md-typeset .toc .md-nav--secondary {
                margin-left: -2em;
            }
            .md-typeset .toc .md-nav__list {
                margin: 0;
            }
            .md-typeset .toc ul {
                list-style: none;
            }
            @media print {
                .md-typeset .toc {
                    display: block;
                    page-break-after: always;
                }
                .md-typeset .toc .md-nav__link {
                    color: var(--md-typeset-a-color);
                }
                .md-typeset .toc .md-nav__link.md-nav__link--active {
                    font-weight: unset;
                }
            }
        </style>
<div class="toc">
<h2>Table of Content</h2>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#1-reentrant">
    1. Reentrant
  </a>
<nav aria-label="1. Reentrant" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#11-rules-for-reentrant">
    1.1. Rules for reentrant
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#12-examples">
    1.2. Examples
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#2-newlib-implementation">
    2. Newlib implementation
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#3-newlib-reentrant">
    3. Newlib reentrant
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#4-freertos-supports-newlib-reentrant">
    4. FreeRTOS supports Newlib reentrant
  </a>
<nav aria-label="4. FreeRTOS supports Newlib reentrant" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#41-switching-context">
    4.1. Switching context
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#42-concurrency-protection">
    4.2. Concurrency protection
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#5-lab-0-reentrant-printf-function">
    5. Lab 0: Reentrant printf function
  </a>
<nav aria-label="5. Lab 0: Reentrant printf function" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#51-precondition">
    5.1. Precondition
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#52-create-2-printing-tasks">
    5.2. Create 2 printing tasks
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#53-define-messages-and-print-out">
    5.3. Define messages and print out
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#54-compile-and-run">
    5.4. Compile and Run
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#55-turn-on-newlib-reentrant">
    5.5. Turn on Newlib reentrant
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#56-debug-and-analyze">
    5.6. Debug and Analyze
  </a>
<nav aria-label="5.6. Debug and Analyze" class="md-nav">
<ul class="md-nav__list">
<li class="md-nav__item">
<a class="md-nav__link" href="#561-non-reentrant">
    5.6.1. Non-reentrant
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#562-reentrant">
    5.6.2. Reentrant
  </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#6-integrate-newlib-memory-scheme">
    6. Integrate Newlib memory scheme
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#7-references">
    7. References
  </a>
</li>
</ul>
</nav>
</div>
<div class="btn-actions screen-only">
<p><a class="md-button" href="..\..\..\..\pdfs\blog\stm32\free-rtos\reentrant\free-rtos__Reentrant.pdf"><span class="twemoji"><svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7 7-7z"></path></svg></span>PDF</a><a class="md-button" href="https://github.com/vuquangtrong/STM32-Tutorials/blob/main/Archives/F411CE_FreeRTOS_Newlib_Reentrant.zip"><span class="twemoji"><svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"></path></svg></span> F411CE_FreeRTOS_Newlib_Reentrant.zip</a>
<a class="md-button" href="https://github.com/vuquangtrong/STM32-Tutorials/blob/main/Archives/F411CE_FreeRTOS_heap_useNewlib.zip"><span class="twemoji"><svg viewbox="0 0 640 512" xmlns="http://www.w3.org/2000/svg"><path d="m278.9 511.5-61-17.7c-6.4-1.8-10-8.5-8.2-14.9L346.2 8.7c1.8-6.4 8.5-10 14.9-8.2l61 17.7c6.4 1.8 10 8.5 8.2 14.9L293.8 503.3c-1.9 6.4-8.5 10.1-14.9 8.2zm-114-112.2 43.5-46.4c4.6-4.9 4.3-12.7-.8-17.2L117 256l90.6-79.7c5.1-4.5 5.5-12.3.8-17.2l-43.5-46.4c-4.5-4.8-12.1-5.1-17-.5L3.8 247.2c-5.1 4.7-5.1 12.8 0 17.5l144.1 135.1c4.9 4.6 12.5 4.4 17-.5zm327.2.6 144.1-135.1c5.1-4.7 5.1-12.8 0-17.5L492.1 112.1c-4.8-4.5-12.4-4.3-17 .5L431.6 159c-4.6 4.9-4.3 12.7.8 17.2L523 256l-90.6 79.7c-5.1 4.5-5.5 12.3-.8 17.2l43.5 46.4c4.5 4.9 12.1 5.1 17 .6z"></path></svg></span> F411CE_FreeRTOS_heap_useNewlib.zip</a></p>
</div>
<h2 id="1-reentrant">1. Reentrant<a class="headerlink" href="#1-reentrant" title="Permanent link">⚓︎</a></h2>
<p>Reentrant is an attribute of a piece of code and basically means it can be re-entered by another execution flow, for example by an interrupt or by another task or thread.</p>
<p>Generally speaking, a function produces output data based on some input data (though both are optional, in general). Shared data could be accessed by any function at any time. If data can be changed by any function (and none keep track of those changes), there is no guarantee to those that share a datum that that datum is the same as at any time before.</p>
<p>Data has a characteristic called scope, which describes where in a program the data may be used. Data scope is either global (outside the scope of any function and with an indefinite extent) or local (created each time a function is called and destroyed upon exit).</p>
<p>Local data is not shared by any routines, re-entering or not; therefore, it does not affect re-entrance. Global data is defined outside functions and can be accessed by more than one function, either in the form of global variables (data shared between all functions), or as static variables (data shared by all invocations of the same function).</p>
<p>Reentrant is distinct from, but closely related to, thread-safety. A function can be thread-safe and still not reentrant.</p>
<h3 id="11-rules-for-reentrant">1.1. Rules for reentrant<a class="headerlink" href="#11-rules-for-reentrant" title="Permanent link">⚓︎</a></h3>
<ol>
<li>Reentrant code may not hold any static or global non-constant data.</li>
<li>Reentrant code may not modify itself.</li>
<li>Reentrant code may not call non-reentrant computer programs or routines.</li>
</ol>
<h3 id="12-examples">1.2. Examples<a class="headerlink" href="#12-examples" title="Permanent link">⚓︎</a></h3>
<p>Two functions below are reentrant:</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">g</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>However, if <code>f()</code> depends on non-constant global variable, both functions become non-reentrant, such as:</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="n">v</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">v</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">v</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">g</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>Some functions are thread-safe, but not reentrant, such as below function. <code>function()</code> can be called by different threads without any problem. But, if the function is used in a reentrant interrupt handler and a second interrupt arises inside the function, the second routine will hang forever.</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">function</span><span class="p">()</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">mutex_lock</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c1">// function body</span>

<span class="w">    </span><span class="n">mutex_unlock</span><span class="p">();</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<h2 id="2-newlib-implementation">2. Newlib implementation<a class="headerlink" href="#2-newlib-implementation" title="Permanent link">⚓︎</a></h2>
<p>GNU ARM libraries use <code>Newlib</code> to provide standard implementation of C libraries. However, to reduce the code size and make it independent to hardware, there is a lightweight version <code>Newlib-nano</code> used in MCUs.</p>
<p>The <code>Newlib</code> library maps standard C functions to a specific implementation environment through a chain of functions, for example:</p>
<ol>
<li><code>write()</code> invokes <code>_write_r()</code> with the current reentrant context (e.g. thread/task-unique errno);</li>
<li><code>_write_r()</code> invokes <code>_write()</code> and copies errno appropriately;</li>
<li><code>_write()</code> must be provided by something. By default,</li>
</ol>
<p><mark>The <code>Newlib-nano</code> library does not provide an implementation of low-level system calls which are used by C standard libraries, such as <code>_write()</code> or <code>_read()</code></mark>.</p>
<p>To make the application compilable, a new library named <code>nosys</code> (enabled with <code>-specs=nosys.specs</code> to the <code>gcc</code> linker command line) should be added. This library just provide a simple implementation of low-level system calls which mostly return a by-pass value.CubeMX, with <code>nosys</code>, will generate <code>syscalls.c</code> and <code>sysmem.c</code> to provide low-level implementation for <code>Newlib-nano</code> interface:</p>
<p><br/>
<strong>Function and data object definitions</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="kt">char</span><span class="w"> </span><span class="o">**</span><span class="w"> </span><span class="n">environ</span><span class="p">;</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">_chown</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="kt">uid_t</span><span class="w"> </span><span class="n">owner</span><span class="p">,</span><span class="w"> </span><span class="kt">gid_t</span><span class="w"> </span><span class="n">group</span><span class="p">);</span><span class="w"></span>
<span class="n">int_execve</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">argv</span><span class="p">[],</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">envp</span><span class="p">[]);</span><span class="w"></span>
<span class="kt">pid_t</span><span class="w"> </span><span class="nf">_fork</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
<span class="kt">pid_t</span><span class="w"> </span><span class="nf">_getpid</span><span class="w"> </span><span class="p">(</span><span class="kt">void</span><span class="p">);</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">_gettimeofday</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span> <span class="nc">timeval</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tv</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span> <span class="nc">timezone</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">tz</span><span class="p">);</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">_kill</span><span class="w"> </span><span class="p">(</span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">sig</span><span class="p">);</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">_link</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">oldpath</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">newpath</span><span class="p">);</span><span class="w"></span>
<span class="kt">ssize_t</span><span class="w"> </span><span class="nf">_readlink</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">bufsiz</span><span class="p">);</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">_stat</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span> <span class="nc">stat</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">);</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">_symlink</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">oldpath</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">newpath</span><span class="p">);</span><span class="w"></span>
<span class="kt">clock_t</span><span class="w"> </span><span class="nf">_times</span><span class="w"> </span><span class="p">(</span><span class="k">struct</span> <span class="nc">tms</span><span class="w"> </span><span class="o">*</span><span class="n">buf</span><span class="p">);</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">_unlink</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pathname</span><span class="p">);</span><span class="w"></span>
<span class="kt">pid_t</span><span class="w"> </span><span class="nf">_wait</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">status</span><span class="p">);</span><span class="w"></span>
<span class="kt">void</span><span class="w"> </span><span class="nf">_exit</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">status</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p><br/>
<strong>File Descriptor Operations</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">_close</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">);</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">_fstat</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">struct</span> <span class="nc">stat</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">);</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">_isatty</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">);</span><span class="w"></span>
<span class="kt">off_t</span><span class="w"> </span><span class="nf">_lseek</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">off_t</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">whence</span><span class="p">);</span><span class="w"></span>
<span class="kt">int</span><span class="w"> </span><span class="nf">_open</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">pathname</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">flags</span><span class="p">);</span><span class="w"></span>
<span class="kt">ssize_t</span><span class="w"> </span><span class="nf">_read</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="p">);</span><span class="w"></span>
<span class="kt">ssize_t</span><span class="w"> </span><span class="nf">_write</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">fd</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">buf</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">count</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<p><br/>
<strong>Heap Management</strong>:</p>
<div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nf">_sbrk</span><span class="w"> </span><span class="p">(</span><span class="kt">ptrdiff_t</span><span class="w"> </span><span class="n">increment</span><span class="p">);</span><span class="w"></span>
</code></pre></div>
<h2 id="3-newlib-reentrant">3. Newlib reentrant<a class="headerlink" href="#3-newlib-reentrant" title="Permanent link">⚓︎</a></h2>
<p>The <code>Newlib</code> library does support reentrant, but for <code>Newlib-nano</code>, the reentrant attribute depends on how its interfaces are implemented.</p>
<p>The most concerned functions of reentrant support are <code>malloc()</code> and <code>free()</code> which directly are related to dynamic memory management. If these functions are not reentrant, the information of memory layout will be messed up if there are multiple calls to <code>malloc()</code> or <code>free()</code> at a time.</p>
<p><code>Newlib</code> maintains information it needs to support each separate context (thread/task/ISR) in a <em class="noem">reentrant structure</em>. This includes things like a thread-specific <em>errno</em>, thread-specific <code>pointers to allocated buffers</code>, etc. The active reentrant structure is pointed at by global pointer <code>_impure_ptr</code>, which initially points to a statically allocated structure instance.</p>
<p><code>Newlib</code> requires below things to complete its reentrant:</p>
<ol>
<li>
<p>Switching context. Multiple reentrant structures (one per context) must be created, initialized, cleaned and pointing upon <code>_impure_ptr</code> to the correct context each time the context is switching</p>
</li>
<li>
<p>Concurrency protection. For example of using <code>malloc()</code>, it should be <code>lock()</code> and <code>unlock()</code> in that function to make it thread-safe first</p>
</li>
</ol>
<h2 id="4-freertos-supports-newlib-reentrant">4. FreeRTOS supports Newlib reentrant<a class="headerlink" href="#4-freertos-supports-newlib-reentrant" title="Permanent link">⚓︎</a></h2>
<h3 id="41-switching-context">4.1. Switching context<a class="headerlink" href="#41-switching-context" title="Permanent link">⚓︎</a></h3>
<p>FreeRTOS provides support for Newlib’s context management. In <code>FreeRTOSconfig.h</code>, add:</p>
<div class="highlight"><pre><span></span><code><span class="cm">/* The following flag must be enabled only when using Newlib */</span><span class="w"></span>
<span class="cp">#define configUSE_NEWLIB_REENTRANT           1</span>
</code></pre></div>
<p>Be default, STM32 projects generated by STM32CubeIDE use <code>Newlib-nano</code>. Whenever FreeRTOS is enabled, IDE will prompt to enable <strong>Newlib Reentrant</strong> attribute:</p>
<p>
<figure><img src="ide_freertos_newlib_reentrant.png"/><figcaption>A prompt asking to enable Newlib reentrant</figcaption>
</figure>
</p>
<p>With this option <code>configUSE_NEWLIB_REENTRANT = 1</code>, FreeRTOS does the following (in<code>task.c</code>):</p>
<ul>
<li>For each task, allocate and initialize a Newlib reentrant structure in the task control block</li>
<li>Each task switch, set <code>_impure_ptr</code> to point to the newly active task’s reentrant structure</li>
<li>On task destruction, clean up the reentrant structure (help Newlib free any associated memory)</li>
</ul>
<h3 id="42-concurrency-protection">4.2. Concurrency protection<a class="headerlink" href="#42-concurrency-protection" title="Permanent link">⚓︎</a></h3>
<p>There is one more thing to fully support Newlib reentrant: FreeRTOS Memory Management.</p>
<p>FreeRTOS internally uses its own memory management scheme with different heap management implementations in <code>heapxx.c</code>, such as <code>heap_1</code>, or <code>heap_4</code>.</p>
<p><mark>If an application only uses FreeRTOS-provided memory management APIs such as <code>pvPortMalloc()</code> and <code>vPortFree()</code>, this application is safe for Newlib reentrant, because FreeRTOS suspends the task-switching and interrupts during memory management</mark>.</p>
<p>However, many third party libraries do use the standard C <code>malloc()</code> and <code>free()</code> functions. For those cases, the Concurrency protection is not guaranteed. That is the reason that Dave Nadler implemented a new heap scheme for Newlib in FreeRTOS. Details in <a href="https://nadler.com/embedded/NewlibAndFreeRTOS.html">https://nadler.com/embedded/NewlibAndFreeRTOS.html</a>.</p>
<div class="admonition caution">
<p class="admonition-title">FreeRTOS in STM32CubeMX</p>
<p>The FreeRTOS version shipped in STM32CubeMX does not fully resolve Memory Management for Newlib. Dave Nadler provides a version for STM32 at <a href="https://github.com/DRNadler/FreeRTOS_helpers/blob/master/heap_useNewlib_ST.c">heap_useNewlib_ST.c</a>. The usage will be covered in a below section.</p>
</div>
<h2 id="5-lab-0-reentrant-printf-function">5. Lab 0: Reentrant <code>printf</code> function<a class="headerlink" href="#5-lab-0-reentrant-printf-function" title="Permanent link">⚓︎</a></h2>
<p>This example project demonstrates an issue when using <code>printf()</code> function without reentrant enabled for Newlib in FreeRTOS. In that case, the data printed out is interrupted by different tasks.</p>
<h3 id="51-precondition">5.1. Precondition<a class="headerlink" href="#51-precondition" title="Permanent link">⚓︎</a></h3>
<p>Let’s create a new FreeRTOS application using STM32CubeMX with below settings:</p>
<ol>
<li>Time base Source for HAL is moved to a general timer, such as TIM6 or TIM10, TIM11</li>
<li>An UART port is enabled, such as UART1 TX on the pin <strong>PA9</strong></li>
<li>FreeRTOS is enabled with configs:<ol>
<li>CMSIS V2 is selected</li>
<li>Memory Management Scheme is either <code>heap_3</code> or <code>heap_4</code></li>
<li>Newlib setting is <code>USE_NEWLIB_REENTRANT = Disabled</code></li>
</ol>
</li>
</ol>
<h3 id="52-create-2-printing-tasks">5.2. Create 2 printing tasks<a class="headerlink" href="#52-create-2-printing-tasks" title="Permanent link">⚓︎</a></h3>
<p>Add 2 tasks: <code>Task1</code> and <code>Task2</code> which call to a same function <code>PrintTask</code> but with different input messages <code>message1</code> and <code>message2</code>. Note that two tasks have the same priority.</p>
<p>
<figure><img src="lab_rtos_two_tasks.png"/><figcaption>Add 2 printing tasks</figcaption>
</figure>
</p>
<h3 id="53-define-messages-and-print-out">5.3. Define messages and print out<a class="headerlink" href="#53-define-messages-and-print-out" title="Permanent link">⚓︎</a></h3>
<p>Two different messages will be prepared. To make the issue happens, the length of messages will be chosen to be long enough, such as 128 bytes (comparing to 128 * 4 bytes of the task stack size).</p>
<div class="highlight"><pre><span></span><code><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">message1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"................................................................................................................................"</span><span class="p">;</span><span class="w"></span>
<span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">message2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++"</span><span class="p">;</span><span class="w"></span>
</code></pre></div>
<p>The function <code>PrintTask()</code> will print out a message along with the task name, the Reentrant config, an increasing counter to see new messages clearly.</p>
<div class="highlight"><pre><span></span><code><span class="cp">#include</span><span class="w"> </span><span class="cpf">"FreeRTOSConfig.h"</span><span class="cp"></span>

<span class="kt">void</span><span class="w"> </span><span class="nf">PrintTask</span><span class="p">(</span><span class="kt">void</span><span class="w"> </span><span class="o">*</span><span class="n">argument</span><span class="p">)</span><span class="w"></span>
<span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pcTaskGetName</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">message</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">argument</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="kt">char</span><span class="w"> </span><span class="n">counter</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="cm">/* Infinite loop */</span><span class="w"></span>
<span class="w">  </span><span class="k">for</span><span class="p">(;;)</span><span class="w"></span>
<span class="w">  </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="n">printf</span><span class="p">(</span><span class="s">"%d %s: %03d %s</span><span class="se">\r\n</span><span class="s">"</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="n">configUSE_NEWLIB_REENTRANT</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">counter</span><span class="o">++</span><span class="p">,</span><span class="w"> </span><span class="n">message</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">osDelay</span><span class="p">(</span><span class="mi">500</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>A final step is to redirect printed data to an UART port, such as USART1 using the low-level <code>_write()</code> function:</p>
<div class="highlight"><pre><span></span><code><span class="kt">int</span><span class="w"> </span><span class="nf">_write</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="w"> </span><span class="o">*</span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">len</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="c1">// block write to UART if it is not ready</span>
<span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="n">HAL_UART_GetState</span><span class="p">(</span><span class="o">&amp;</span><span class="n">huart1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">HAL_UART_STATE_READY</span><span class="p">);</span><span class="w"></span>

<span class="w">    </span><span class="n">HAL_StatusTypeDef</span><span class="w"> </span><span class="n">hstatus</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">hstatus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">HAL_UART_Transmit</span><span class="p">(</span><span class="o">&amp;</span><span class="n">huart1</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="w"> </span><span class="n">ptr</span><span class="p">,</span><span class="w"> </span><span class="n">len</span><span class="p">,</span><span class="w"></span>
<span class="w">                                </span><span class="n">HAL_MAX_DELAY</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">hstatus</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">HAL_OK</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">len</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<h3 id="54-compile-and-run">5.4. Compile and Run<a class="headerlink" href="#54-compile-and-run" title="Permanent link">⚓︎</a></h3>
<p>Build the project and run a target board, the output will be messed up as it can be seen that characters in the <code>messages1</code> is printed in the line of the <code>messages2</code>.</p>
<h3 id="55-turn-on-newlib-reentrant">5.5. Turn on Newlib reentrant<a class="headerlink" href="#55-turn-on-newlib-reentrant" title="Permanent link">⚓︎</a></h3>
<p>If set the <code>configUSE_NEWLIB_REENTRANT = 1</code>, the issue will not happen!</p>
<p>
<figure><img src="lab_diff_outputs.png"/><figcaption>Different outputs on different reentrant settings</figcaption>
</figure>
</p>
<h3 id="56-debug-and-analyze">5.6. Debug and Analyze<a class="headerlink" href="#56-debug-and-analyze" title="Permanent link">⚓︎</a></h3>
<p>Enable RTOS Kernel Awareness feature to seen task information and call stack when system is suspended.</p>
<p>
<figure><img src="lab_debug_rtos_awareness.png"/><figcaption>Select RTOS kernel awareness feature</figcaption>
</figure>
</p>
<h4 id="561-non-reentrant">5.6.1. Non-reentrant<a class="headerlink" href="#561-non-reentrant" title="Permanent link">⚓︎</a></h4>
<p><strong>Step 1</strong>: Task 1 formats its output string.</p>
<p><strong>Step 2</strong>: Task 1 starts printing the formatted string saved at the address pointed by the <code>ptr</code> pointer.</p>
<p><strong>Step 3</strong>: Task 1 is suspended, Task 2 formats its output string. <mark>Due to non-reentrant, <code>printf</code> saves the formatted string at a fixed location — the same location of formatted string in Task 1, causing an overwritten data</mark>.</p>
<p><strong>Step 4</strong>: Task 2 cannot print as it has to wait for a ready flag.</p>
<p><strong>Step 5</strong>: Task 1 is reactivated after a SysTick interruption, and <mark>Task 1 continues printing but the content of the formatted string is overwritten when Task2 formats its string</mark>.</p>
<p>
<figure><img src="lab_nre_step1.png"/><figcaption>Non-reentrant debug step 1</figcaption>
</figure>
<figure><img src="lab_nre_step2.png"/><figcaption>Non-reentrant debug step 2</figcaption>
</figure>
<figure><img src="lab_nre_step3.png"/><figcaption>Non-reentrant debug step 3</figcaption>
</figure>
<figure><img src="lab_nre_step4.png"/><figcaption>Non-reentrant debug step 4</figcaption>
</figure>
<figure><img src="lab_nre_step5.png"/><figcaption>Non-reentrant debug step 5</figcaption>
</figure>
</p>
<h4 id="562-reentrant">5.6.2. Reentrant<a class="headerlink" href="#562-reentrant" title="Permanent link">⚓︎</a></h4>
<p>When reentrant is enabled, each task has its own reentrant struct and uses its own stack for Newlib functions. As a result, there is no shared memory location used by both tasks, that avoid overwriting data.</p>
<p>
<figure><img src="lab_re_task2.png"/><figcaption>Task2 print stack</figcaption>
</figure>
<figure><img src="lab_re_task1.png"/><figcaption>Task1 print stack</figcaption>
</figure>
</p>
<h2 id="6-integrate-newlib-memory-scheme">6. Integrate Newlib memory scheme<a class="headerlink" href="#6-integrate-newlib-memory-scheme" title="Permanent link">⚓︎</a></h2>
<p>As mentioned above, Dave Nadler provides a version for STM32 at <a href="https://github.com/DRNadler/FreeRTOS_helpers/blob/master/heap_useNewlib_ST.c">heap_useNewlib_ST.c</a>. It is not officially supported by ST.</p>
<p>A method to ensure thread-safe for <code>malloc()</code> and <code>free()</code> is to wrap Newlib malloc-like functions to use FreeRTOS’s porting memory management functions. However, FreeRTOS heap implementations do not support <code>realloc()</code>.</p>
<p>The <code>heap_usNewlib_ST</code> scheme choose another method to solve malloc-like functions’ thread-safe. This memory scheme implements thread-safe for <code>malloc()</code> and <code>free()</code> in Newlib, and then overwrites FreeRTOS’s memory function to use Newlib’s functions.</p>
<p>Here are step to integrate <code>heap_usNewlib_ST</code> into STM32 project:</p>
<ol>
<li>Exclude <code>sysmem.c</code> file from build. This file provides an implementation of <code>_sbrk()</code> which is used by <code>malloc()</code></li>
<li>Exclude FreeRTOS heap management such as <code>heap_4.c</code> which implements <code>pvPortMalloc()</code> and <code>vPortFree()</code></li>
<li>Include <code>heap_useNewlib_ST.c</code> to project.</li>
<li>
<p>Define 2 configs below to support ISR stack check</p>
<div class="highlight"><pre><span></span><code><span class="cp">#define configISR_STACK_SIZE_WORDS (128) </span><span class="c1">// DRN in WORDS, must be valid constant for assembler</span>
<span class="cp">#define configSUPPORT_ISR_STACK_CHECK  1   </span><span class="c1">// DRN initialize and check ISR stack</span>
</code></pre></div>
</li>
<li>
<p>Set reentrant support using <code>#define configUSE_NEWLIB_REENTRANT 1</code></p>
</li>
</ol>
<h2 id="7-references">7. References<a class="headerlink" href="#7-references" title="Permanent link">⚓︎</a></h2>
<ul>
<li>FreeRTOS Memory Management: <a href="https://www.freertos.org/a00111.html">https://www.freertos.org/a00111.html</a></li>
<li>Newlib interface: <a href="http://pabigot.github.io/bspacm/Newlib.html">http://pabigot.github.io/bspacm/Newlib.html</a></li>
<li>Newlib FreeRTOS Memory Management: <a href="https://nadler.com/embedded/NewlibAndFreeRTOS.html">https://nadler.com/embedded/NewlibAndFreeRTOS.html</a></li>
<li>Thread-safe in C library: <a href="https://developer.arm.com/documentation/dui0492/i/the-c-and-c---libraries/thread-safe-c-library-functions">https://developer.arm.com/documentation/dui0492/i/the-c-and-c---libraries/thread-safe-c-library-functions</a></li>
</ul>
<div data-value="https://www.codeinsideout.com/blog/stm32/free-rtos/reentrant/" id="page_url"></div>
<div data-value="blog/stm32/free-rtos/reentrant/" id="page_identifier"></div>
<div>
<h2 id="__comments">Comments</h2>
<div id="disqus_thread"></div>
<script>var disqus_config = function () { this.page.url = "https://www.codeinsideout.com/blog/stm32/free-rtos/reentrant/", this.page.identifier = "blog/stm32/free-rtos/reentrant/" }; window.addEventListener("load", function () { var e = document, i = e.createElement("script"); i.src = "//vuquangtrong-github-io.disqus.com/embed.js", i.setAttribute("data-timestamp", +new Date), (e.head || e.body).appendChild(i) })</script>
</div>
</article>
</div>
</div>
<a class="md-top md-icon" data-md-component="top" data-md-state="hidden" href="#">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path></svg>
            Back to top
          </a>
</main>
<footer class="md-footer">
<nav aria-label="Footer" class="md-footer__inner md-grid">
<a aria-label="Previous: Tasks" class="md-footer__link md-footer__link--prev" href="../tasks/" rel="prev">
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"></path></svg>
</div>
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Previous
              </span>
              Tasks
            </div>
</div>
</a>
<a aria-label="Next: Stack Overflow" class="md-footer__link md-footer__link--next" href="../stack/" rel="next">
<div class="md-footer__title">
<div class="md-ellipsis">
<span class="md-footer__direction">
                Next
              </span>
              Stack Overflow
            </div>
</div>
<div class="md-footer__button md-icon">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"></path></svg>
</div>
</a>
</nav>
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-footer-copyright">
<div class="md-footer-copyright__highlight">
            © 2021 Code Inside Out <div style="display:none"><div>
</div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
          Material for MkDocs
        </a>
</div>
<div>
    using
    <a href="https://github.com/vuquangtrong/mkdocs-material-blog">
        MkDocs Material Blog
    </a>
    theme
</div>
</div>
</div>
<div class="md-footer-social">
<a class="md-footer-social__link" href="https://github.com/vuquangtrong" rel="noopener" target="_blank" title="vuquangtrong">
<svg viewbox="0 0 480 512" xmlns="http://www.w3.org/2000/svg"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://facebook.com/trongvq" rel="noopener" target="_blank" title="trongvq">
<svg viewbox="0 0 320 512" xmlns="http://www.w3.org/2000/svg"><path d="m279.14 288 14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"></path></svg>
</a>
<a class="md-footer-social__link" href="https://www.linkedin.com/in/vqtrong" rel="noopener" target="_blank" title="vqtrong">
<svg viewbox="0 0 448 512" xmlns="http://www.w3.org/2000/svg"><path d="M100.28 448H7.4V148.9h92.88zM53.79 108.1C24.09 108.1 0 83.5 0 53.8a53.79 53.79 0 0 1 107.58 0c0 29.7-24.1 54.3-53.79 54.3zM447.9 448h-92.68V302.4c0-34.7-.7-79.2-48.29-79.2-48.29 0-55.69 37.7-55.69 76.7V448h-92.78V148.9h89.08v40.8h1.3c12.4-23.5 42.69-48.3 87.88-48.3 94 0 111.28 61.9 111.28 142.3V448z"></path></svg>
</a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.instant", "navigation.tabs", "navigation.top", "header.autohide", "search.suggest", "search.highlight"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../../../assets/javascripts/workers/search.709b4209.min.js", "version": null}</script>
<script src="../../../../assets/javascripts/bundle.febc23d1.min.js"></script>
<script src="../../../../assets/view-bigimg.js"></script>
<script src="../../../../assets/extra.js"></script>
</body>
</html>